<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>F# Data: Converting between JSON and XML
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The F# Data library implements type providers for working with structured file formats (CSV, HTML, JSON and XML) and for accessing the WorldBank data. It also includes helpers for parsing CSV, HTML and JSON files, and for sending HTTP requests.">
    <meta name="author" content="Tomas Petricek; Gustavo Guerra">

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/style.css" />
    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/fsdata.css" />
    <script type="text/javascript" src="/FSharp.Data/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://bluemountaincapital.github.io/Deedle"><img height="16" width="16" src="http://fsharp.org/images/thumbs/Deedle.png" /> Deedle</a></li>
          <li><a href="http://bluemountaincapital.github.io/FSharpRProvider"><img height=" 16" width="16" src="http://fsharp.org/images/thumbs/FSharpRProvider.png" /> R Provider</a></li>
          <li><a href="http://fsharp.github.io/FSharp.Charting/"><img height="16" width="16" src="http://fsharp.org/images/thumbs/FSharp.Charting.png" /> F# Charting</a></li>
          <li><a href="http://fsprojects.github.io/FSharp.Data.Toolbox"><img height="16" width="16" src="http://fsharp.org/images/thumbs/FSharp.Data.Toolbox.png" /> F# Data Toolbox</a></li>
        </ul>
        <h3 class="muted"><a href="/FSharp.Data/index.html">F# Data</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1>F# Data: Converting between JSON and XML</h1>
<p>This tutorial shows how to implement convert JSON document (represented using
the <code>JsonValue</code> type discussed in <a href="JsonValue.html">JSON parser article</a>) to an
XML document (represented as <code>XElement</code>) and the other way round.
This functionality is not directly available in the F# Data library, but it can
be very easily implemented by recursively walking over the JSON (or XML) document.</p>
<p>If you want to use the JSON to/from XML conversion in your code, you can copy the
<a href="https://github.com/fsharp/FSharp.Data/blob/master/docs/content/tutorials/JsonToXml.fsx">source from GitHub</a> and just include it in your project. If you use these
functions often and would like to see them in the F# Data library, please submit
a <a href="https://github.com/fsharp/FSharp.Data/issues">feature request</a>.</p>
<h2>Initialization</h2>
<p>We will be using the LINQ to XML API (available in <code>System.Xml.Linq.dll</code>) and the
<code>JsonValue</code> which is available in the <code>FSharp.Data</code> namespace:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;System.Xml.Linq.dll&quot;</span>
<span class="prep">#r</span> <span class="s">&quot;../../../bin/FSharp.Data.dll&quot;</span>
<span class="k">open</span> <span class="i">System</span><span class="o">.</span><span class="i">Xml</span><span class="o">.</span><span class="i">Linq</span>
<span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Data</span>
</code></pre></td>
</tr>
</table>
<p>In this script, we create a conversion that returns an easy to process value, but the
conversion is not reversible (e.g. converting JSON to XML and then back to JSON will
produce a different value).</p>
<h2>Converting XML to JSON</h2>
<p>Although XML and JSON are quite similar formats, there is a number of subtle differences.
In particular, XML distinguishes between <em>attributes</em> and <em>child elements</em>. Moreover,
all XML elements have a name, while JSON arrays or records are anonymous (but records
have named fields). Consider, for example, the following XML:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="xml"><span class="k">&lt;</span><span class="i">channel</span> <span class="o">version</span><span class="k">="1.0"</span><span class="k">&gt;</span>
  <span class="k">&lt;</span><span class="i">title</span> <span class="o">text</span><span class="k">="Sample input"</span> <span class="k">/&gt;</span>
  <span class="k">&lt;</span><span class="i">item</span> <span class="o">value</span><span class="k">="First"</span> <span class="k">/&gt;</span>
  <span class="k">&lt;</span><span class="i">item</span> <span class="o">value</span><span class="k">="Second"</span> <span class="k">/&gt;</span>
<span class="k">&lt;/</span><span class="i">channel</span><span class="k">&gt;</span>
</code></pre></td></tr></table>
<p>The JSON that we produce will ignore the top-level element name (<code>channel</code>). It produces
a record that contains a unique field for every attribute and a name of a child element.
If an element appears multiple times, it is turned into an array:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="js">{ <span class="s">"version"</span>: <span class="s">"1.0"</span>,
  <span class="s">"title"</span>: { <span class="s">"text"</span>: <span class="s">"Sample input"</span> },
  <span class="s">"items"</span>: [ { <span class="s">"value"</span>: <span class="s">"First"</span> }, 
             { <span class="s">"value"</span>: <span class="s">"Second"</span> } ]  }
</code></pre></td></tr></table>
<p>As you can see, the <code>item</code> element has been automatically pluralized to <code>items</code> and the
array contains two record values that consist of the <code>value</code> attribute.</p>
<p>The conversion function is a recursive function that takes a <code>XElement</code> and produces
<code>JsonValue</code>. It builds JSON records (using <code>JsonValue.Record</code>) and arrays (using
<code>JsonValue.Array</code>). All attribute values are turned into <code>JsonValue.String</code> - the
sample does not imlement more sophisticated conversion that would turn numeric
attributes to a corresponding JSON type:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Creates a JSON representation of a XML element</span>
<span class="k">let</span> <span class="k">rec</span> <span class="i">fromXml</span> (<span class="i">xml</span><span class="o">:</span><span class="i">XElement</span>) <span class="o">=</span>

  <span class="c">// Create a collection of key/value pairs for all attributes      </span>
  <span class="k">let</span> <span class="i">attrs</span> <span class="o">=</span> 
    [ <span class="k">for</span> <span class="i">attr</span> <span class="k">in</span> <span class="i">xml</span><span class="o">.</span><span class="i">Attributes</span>() <span class="k">-&gt;</span>
        (<span class="i">attr</span><span class="o">.</span><span class="i">Name</span><span class="o">.</span><span class="i">LocalName</span>, <span class="i">JsonValue</span><span class="o">.</span><span class="i">String</span> <span class="i">attr</span><span class="o">.</span><span class="i">Value</span>) ]

  <span class="c">// Function that turns a collection of XElement values</span>
  <span class="c">// into an array of JsonValue (using fromXml recursively)</span>
  <span class="k">let</span> <span class="i">createArray</span> <span class="i">xelems</span> <span class="o">=</span>
    [| <span class="k">for</span> <span class="i">xelem</span> <span class="k">in</span> <span class="i">xelems</span> <span class="k">-&gt;</span> <span class="i">fromXml</span> <span class="i">xelem</span> |]
    <span class="o">|&gt;</span> <span class="i">JsonValue</span><span class="o">.</span><span class="i">Array</span>

  <span class="c">// Group child elements by their name and then turn all single-</span>
  <span class="c">// element groups into a record (recursively) and all multi-</span>
  <span class="c">// element groups into a JSON array using createArray</span>
  <span class="k">let</span> <span class="i">children</span> <span class="o">=</span>
    <span class="i">xml</span><span class="o">.</span><span class="i">Elements</span>() 
    <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">groupBy</span> (<span class="k">fun</span> <span class="i">x</span> <span class="k">-&gt;</span> <span class="i">x</span><span class="o">.</span><span class="i">Name</span><span class="o">.</span><span class="i">LocalName</span>)
    <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">map</span> (<span class="k">fun</span> (<span class="i">key</span>, <span class="i">childs</span>) <span class="k">-&gt;</span>
        <span class="k">match</span> <span class="i">Seq</span><span class="o">.</span><span class="i">toList</span> <span class="i">childs</span> <span class="k">with</span>
        | [<span class="i">child</span>] <span class="k">-&gt;</span> <span class="i">key</span>, <span class="i">fromXml</span> <span class="i">child</span>
        | <span class="i">children</span> <span class="k">-&gt;</span> <span class="i">key</span> <span class="o">+</span> <span class="s">&quot;s&quot;</span>, <span class="i">createArray</span> <span class="i">children</span> )
        
  <span class="c">// Concatenate elements produced for child elements &amp; attributes</span>
  <span class="i">Array</span><span class="o">.</span><span class="i">append</span> (<span class="i">Array</span><span class="o">.</span><span class="i">ofList</span> <span class="i">attrs</span>) (<span class="i">Array</span><span class="o">.</span><span class="i">ofSeq</span> <span class="i">children</span>)
  <span class="o">|&gt;</span> <span class="i">JsonValue</span><span class="o">.</span><span class="i">Record</span>
</code></pre></td>
</tr>
</table>
<h2>Converting JSON to XML</h2>
<p>When converting JSON value to XML, we fact the same mismatch. Consider the following JSON value:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="js">{ <span class="s">"title"</span> : <span class="s">"Sample input"</span>,
  <span class="s">"paging"</span> : { <span class="s">"current"</span>: <span class="n">1</span> },
  <span class="s">"items"</span> : [ <span class="s">"First"</span>, <span class="s">"Second"</span> ] }
</code></pre></td></tr></table>
<p>The top-level record does not have a name, so our conversion produces a list of <code>XObject</code>
values that can be wrapped into an <code>XElement</code> by the user (who has to specify the root
name). Record fields that are a primitive value are turned into attributes, while
complex values (array or record) become objects:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="xml"><span class="k">&lt;</span><span class="i">root</span> <span class="o">title</span><span class="k">="Sample input"</span><span class="k">&gt;</span>
  <span class="k">&lt;</span><span class="i">items</span><span class="k">&gt;</span>
    <span class="k">&lt;</span><span class="i">item</span><span class="k">&gt;</span>First<span class="k">&lt;/</span><span class="i">item</span><span class="k">&gt;</span>
    <span class="k">&lt;</span><span class="i">item</span><span class="k">&gt;</span>Second<span class="k">&lt;/</span><span class="i">item</span><span class="k">&gt;</span>
  <span class="k">&lt;/</span><span class="i">items</span><span class="k">&gt;</span>
  <span class="k">&lt;</span><span class="i">paging</span> <span class="o">current</span><span class="k">="1"</span> <span class="k">/&gt;</span>
<span class="k">&lt;/</span><span class="i">root</span><span class="k">&gt;</span>
</code></pre></td></tr></table>
<p>The conversion function is, again, implemented as a recursive function. This time, we use
pattern matching to distinguish between the different possible cases of <code>JsonValue</code>.
The cases representing a primitive value simply return the value as <code>obj</code>, while array
and record construct nested element(s) or attribute:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Creates an XML representation of a JSON value (works </span>
<span class="c">/// only when the top-level value is an object or an array)</span>
<span class="k">let</span> <span class="i">toXml</span>(<span class="i">x</span><span class="o">:</span><span class="i">JsonValue</span>) <span class="o">=</span>
  <span class="c">// Helper functions for constructing XML </span>
  <span class="c">// attributes and XML elements</span>
  <span class="k">let</span> <span class="i">attr</span> <span class="i">name</span> <span class="i">value</span> <span class="o">=</span> 
    <span class="i">XAttribute</span>(<span class="i">XName</span><span class="o">.</span><span class="i">Get</span> <span class="i">name</span>, <span class="i">value</span>) <span class="o">:&gt;</span> <span class="i">XObject</span>
  <span class="k">let</span> <span class="i">elem</span> <span class="i">name</span> (<span class="i">value</span><span class="o">:</span><span class="i">obj</span>) <span class="o">=</span> 
    <span class="i">XElement</span>(<span class="i">XName</span><span class="o">.</span><span class="i">Get</span> <span class="i">name</span>, <span class="i">value</span>) <span class="o">:&gt;</span> <span class="i">XObject</span>

  <span class="c">// Inner recursive function that implements the conversion</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="i">toXml</span> <span class="o">=</span> <span class="k">function</span>
    <span class="c">// Primitive values are returned as objects</span>
    | <span class="i">JsonValue</span><span class="o">.</span><span class="i">Null</span> <span class="k">-&gt;</span> <span class="k">null</span>
    | <span class="i">JsonValue</span><span class="o">.</span><span class="i">Boolean</span> <span class="i">b</span> <span class="k">-&gt;</span> <span class="i">b</span> <span class="o">:&gt;</span> <span class="i">obj</span>
    | <span class="i">JsonValue</span><span class="o">.</span><span class="i">Number</span> <span class="i">number</span> <span class="k">-&gt;</span> <span class="i">number</span> <span class="o">:&gt;</span> <span class="i">obj</span>
    | <span class="i">JsonValue</span><span class="o">.</span><span class="i">Float</span> <span class="i">number</span> <span class="k">-&gt;</span> <span class="i">number</span> <span class="o">:&gt;</span> <span class="i">obj</span>
    | <span class="i">JsonValue</span><span class="o">.</span><span class="i">String</span> <span class="i">s</span> <span class="k">-&gt;</span> <span class="i">s</span> <span class="o">:&gt;</span> <span class="i">obj</span>

    <span class="c">// JSON object becomes a collection of XML</span>
    <span class="c">// attributes (for primitives) or child elements</span>
    | <span class="i">JsonValue</span><span class="o">.</span><span class="i">Record</span> <span class="i">properties</span> <span class="k">-&gt;</span> 
      <span class="i">properties</span> 
      <span class="o">|&gt;</span> <span class="i">Array</span><span class="o">.</span><span class="i">map</span> (<span class="k">fun</span> (<span class="i">key</span>, <span class="i">value</span>) <span class="k">-&gt;</span>
          <span class="k">match</span> <span class="i">value</span> <span class="k">with</span>
          | <span class="i">JsonValue</span><span class="o">.</span><span class="i">String</span> <span class="i">s</span> <span class="k">-&gt;</span> <span class="i">attr</span> <span class="i">key</span> <span class="i">s</span>
          | <span class="i">JsonValue</span><span class="o">.</span><span class="i">Boolean</span> <span class="i">b</span> <span class="k">-&gt;</span> <span class="i">attr</span> <span class="i">key</span> <span class="i">b</span>
          | <span class="i">JsonValue</span><span class="o">.</span><span class="i">Number</span> <span class="i">n</span> <span class="k">-&gt;</span> <span class="i">attr</span> <span class="i">key</span> <span class="i">n</span>
          | <span class="i">JsonValue</span><span class="o">.</span><span class="i">Float</span> <span class="i">n</span> <span class="k">-&gt;</span> <span class="i">attr</span> <span class="i">key</span> <span class="i">n</span>
          | _ <span class="k">-&gt;</span> <span class="i">elem</span> <span class="i">key</span> (<span class="i">toXml</span> <span class="i">value</span>)) <span class="o">:&gt;</span> <span class="i">obj</span>

    <span class="c">// JSON array is turned into a </span>
    <span class="c">// sequence of &lt;item&gt; elements</span>
    | <span class="i">JsonValue</span><span class="o">.</span><span class="i">Array</span> <span class="i">elements</span> <span class="k">-&gt;</span> 
        <span class="i">elements</span> <span class="o">|&gt;</span> <span class="i">Array</span><span class="o">.</span><span class="i">map</span> (<span class="k">fun</span> <span class="i">item</span> <span class="k">-&gt;</span> 
          <span class="i">elem</span> <span class="s">&quot;item&quot;</span> (<span class="i">toXml</span> <span class="i">item</span>)) <span class="o">:&gt;</span> <span class="i">obj</span>

  <span class="c">// Perform the conversion and cast the result to sequence</span>
  <span class="c">// of objects (may fail for unexpected inputs!)</span>
  (<span class="i">toXml</span> <span class="i">x</span>) <span class="o">:?&gt;</span> <span class="i">XObject</span> <span class="i">seq</span>
</code></pre></td>
</tr>
</table>
<h2>Related articles</h2>
<ul>
<li>
<a href="../library/JsonValue.html">F# Data: JSON Parser</a> - a tutorial that introduces
<code>JsonValue</code> for working with JSON values dynamically.
</li>
<li>
<a href="../library/JsonProvider.html">F# Data: JSON Type Provider</a> - discusses F# type provider
that provides type-safe access to JSON data.
</li>
<li>
<a href="../library/XmlProvider.html">F# Data: XML Type Provider</a> - discusses the F# type provider
that provides type-safe access to XML data.
</li>
</ul>


        </div>
        <div class="span3">
          <a href="/FSharp.Data/index.html">
            <img src="/FSharp.Data/images/logo.png" style="width:140px;height:140px;margin:10px 0px 0px 35px;border-style:none;" />
          </a>

          <ul class="nav nav-list" id="menu">

            <li class="nav-header">
              <a href="/FSharp.Data/ja/index.html" class="nflag"><img src="/FSharp.Data/images/ja.png" /></a>
              <a href="/FSharp.Data/index.html" class="nflag nflag2"><img src="/FSharp.Data/images/en.png" /></a>
              F# Data
            </li>

            <li class="divider"></li>

            <li><a href="https://nuget.org/packages/FSharp.Data"><img src="http://img.shields.io/nuget/v/FSharp.Data.svg?style=flat" /></a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data">Source Code on GitHub</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/LICENSE.md">License (Apache 2.0)</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/RELEASE_NOTES.md">Release Notes</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/CONTRIBUTING.md">Contributing to F# Data</a></li>
            
            <li class="nav-header">Documentation</li>

            <li><a href="/FSharp.Data/index.html">Introduction</a></li>

            <li class="divider"></li>

            <li><a href="/FSharp.Data/library/CsvProvider.html">CSV Type Provider</a></li>
            <li><a href="/FSharp.Data/library/HtmlProvider.html">HTML Type Provider</a></li>
            <li><a href="/FSharp.Data/library/JsonProvider.html">JSON Type Provider</a></li>
            <li><a href="/FSharp.Data/library/XmlProvider.html">XML Type Provider</a></li>
            <li><a href="/FSharp.Data/library/WorldBank.html">WorldBank Provider</a></li>

            <li class="divider"></li>

            <li><a href="/FSharp.Data/library/Http.html">HTTP Utilities</a></li>
            <li><a href="/FSharp.Data/library/CsvFile.html">CSV Parser</a></li>
            <li><a href="/FSharp.Data/library/HtmlParser.html">HTML Parser</a></li>
            <li><a href="/FSharp.Data/library/HtmlCssSelectors.html">HTML CSS Selectors</a></li>
            <li><a href="/FSharp.Data/library/JsonValue.html">JSON Parser</a></li>

            <li class="nav-header">Tutorials</li>

            <li><a href="/FSharp.Data/tutorials/JsonToXml.html">Converting between JSON and XML</a></li>
            <li><a href="/FSharp.Data/tutorials/JsonAnonymizer.html">Anonymizing JSON</a></li>

            <li class="nav-header">Reference</li>

            <li><a href="/FSharp.Data/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/fsharp/FSharp.Data"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
  </html>