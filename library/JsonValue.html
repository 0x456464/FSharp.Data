<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>F# Data: JSON Parser
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The F# Data library implements type providers for working with structured file formats (CSV, HTML, JSON and XML) and for accessing the WorldBank data. It also includes helpers for parsing CSV, HTML and JSON files, and for sending HTTP requests.">
    <meta name="author" content="Tomas Petricek; Gustavo Guerra">

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/style.css" />
    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/fsdata.css" />
    <script type="text/javascript" src="/FSharp.Data/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://bluemountaincapital.github.io/Deedle"><img height="16" width="16" src="http://fsharp.org/images/thumbs/Deedle.png" /> Deedle</a></li>
          <li><a href="http://bluemountaincapital.github.io/FSharpRProvider"><img height=" 16" width="16" src="http://fsharp.org/images/thumbs/FSharpRProvider.png" /> R Provider</a></li>
          <li><a href="http://fsharp.github.io/FSharp.Charting/"><img height="16" width="16" src="http://fsharp.org/images/thumbs/FSharp.Charting.png" /> F# Charting</a></li>
          <li><a href="http://fsprojects.github.io/FSharp.Data.Toolbox"><img height="16" width="16" src="http://fsharp.org/images/thumbs/FSharp.Data.Toolbox.png" /> F# Data Toolbox</a></li>
        </ul>
        <h3 class="muted"><a href="/FSharp.Data/index.html">F# Data</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1>F# Data: JSON Parser</h1>
<p>The F# <a href="JsonProvider.html">JSON Type Provider</a> is built on top of an efficient JSON parser written
in F#. This parser is based on a JSON parser available in <a href="http://fsharp3sample.codeplex.com">F# 3.0 Sample Pack</a>,
but F# Data adds a simple API that can be used to access values dynamically.</p>
<p>When working with well-defined JSON documents, it is easier to use the
<a href="JsonProvider.html">type provider</a>, but in a more dynamic scenario or when writing
quick and simple scripts, the parser might be a simpler option.</p>
<h2>Loading JSON documents</h2>
<p>To load a sample JSON document, we first need to reference the <code>FSharp.Data.dll</code> library
(when using F# Interactive) or to add reference to a project.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;../../../bin/FSharp.Data.dll&quot;</span>
<span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Data</span>
</code></pre></td>
</tr>
</table>
<p>The <code>FSharp.Data</code> namespace contains the <code>JsonValue</code> type that can be used
to parse strings formatted using JSON as follows:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">info</span> <span class="o">=</span>
  <span class="i">JsonValue</span><span class="o">.</span><span class="i">Parse</span>(<span class="s">&quot;&quot;&quot; </span>
<span class="s">    { &quot;name&quot;: &quot;Tomas&quot;, &quot;born&quot;: 1985,</span>
<span class="s">      &quot;siblings&quot;: [ &quot;Jan&quot;, &quot;Alexander&quot; ] } &quot;&quot;&quot;</span>)
</code></pre></td>
</tr>
</table>
<p>The parsed value can be processed using pattern matching - the <code>JsonValue</code> type
is a discriminated union with cases such as <code>Record</code>, <code>Collection</code> and others that
can be used to examine the structure.</p>
<h2>Using JSON extensions</h2>
<p>We do not cover this technique in this introduction. Instead, we look at a number
of extensions that become available after opening the <code>FSharp.Data.JsonExtensions</code>
namespace. Once opened, we can write:</p>
<ul>
<li><code>value.AsBoolean()</code> returns the value as boolean if it is either <code>true</code> or <code>false</code>.</li>
<li>
<code>value.AsInteger()</code> returns the value as integer if it is numeric and can be
converted to an integer; <code>value.AsInteger64()</code>, <code>value.AsDecimal()</code> and
<code>value.AsFloat()</code> behave similarly.
</li>
<li><code>value.AsString()</code> returns the value as a string.</li>
<li>
<code>value.AsDateTime()</code> parses the string as a <code>DateTime</code> value using either the
<a href="http://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> format, or using the
<code>\/Date(...)\/</code> JSON format containing number of milliseconds since 1/1/1970.
</li>
<li><code>value.AsGuid()</code> parses the string as a <code>Guid</code> value.</li>
<li>
<code>value?child</code> uses the dynamic operator to obtain a record member named <code>child</code>;
alternatively, you can also use <code>value.GetProperty(child)</code> or an indexer
<code>value.[child]</code>.
</li>
<li>
<code>value.TryGetProperty(child)</code> can be used to safely obtain a record member 
(if the member is missing or the value is not a record then, <code>TryGetProperty</code>
returns <code>None</code>).
</li>
<li>
<code>[ for v in value -&gt; v ]</code> treats <code>value</code> as a collection and iterates over it;
alternatively, it is possible to obtain all elements as an array using
<code>value.AsArray()</code>.
</li>
<li><code>value.Properties()</code> returns a list of all properties of a record node.</li>
<li>
<code>value.InnerText()</code> concatenates all text or text in an array 
(representing e.g. multi-line string).
</li>
</ul>
<p>Methods that may need to parse a numeric value or date (such as <code>AsFloat</code> and
<code>AsDateTime</code>) receive an optional culture parameter.</p>
<p>The following example shows how to process the sample JSON value:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Data</span><span class="o">.</span><span class="i">JsonExtensions</span>

<span class="c">// Print name and birth year</span>
<span class="k">let</span> <span class="i">n</span> <span class="o">=</span> <span class="i">info</span><span class="o">?</span><span class="i">name</span>
<span class="i">printfn</span> <span class="s">&quot;%s (%d)&quot;</span> (<span class="i">info</span><span class="o">?</span><span class="i">name</span><span class="o">.</span><span class="i">AsString</span>()) (<span class="i">info</span><span class="o">?</span><span class="i">born</span><span class="o">.</span><span class="i">AsInteger</span>())

<span class="c">// Print names of all siblings</span>
<span class="k">for</span> <span class="i">sib</span> <span class="k">in</span> <span class="i">info</span><span class="o">?</span><span class="i">siblings</span> <span class="k">do</span>
  <span class="i">printfn</span> <span class="s">&quot;%s&quot;</span> (<span class="i">sib</span><span class="o">.</span><span class="i">AsString</span>())
</code></pre></td>
</tr>
</table>
<p>Note that the <code>JsonValue</code> type does not actually implement the <code>IEnumerable&lt;'T&gt;</code>
interface (meaning that it cannot be passed to <code>Seq.xyz</code> functions). It only has
the <code>GetEnumerator</code> method, which makes it possible to use it in sequence expressions
and with the <code>for</code> loop.</p>
<h2>Parsing WorldBank response</h2>
<p>To look at a more complex example, consider a sample document
<a href="../data/WorldBank.json"><code>data/WorldBank.json</code></a> which was obtained as a response to
a WorldBank request (you can access the WorldBank data more conveniently using
<a href="WorldBank.html">a type provider</a>). The document looks as follows:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="js">[ { <span class="s">"page"</span>: <span class="n">1</span>, <span class="s">"pages"</span>: <span class="n">1</span>, <span class="s">"total"</span>: <span class="n">53</span> },
  [ { <span class="s">"indicator"</span>: {<span class="s">"value"</span>: <span class="s">"Central government debt, total (% of GDP)"</span>},
      <span class="s">"country"</span>: {<span class="s">"id"</span>:<span class="s">"CZ"</span>,<span class="s">"value"</span>:<span class="s">"Czech Republic"</span>},
      <span class="s">"value"</span>:<span class="k">null</span>,<span class="s">"decimal"</span>:<span class="s">"1"</span>,<span class="s">"date"</span>:<span class="s">"2000"</span>},
    { <span class="s">"indicator"</span>: {<span class="s">"value"</span>: <span class="s">"Central government debt, total (% of GDP)"</span>},
      <span class="s">"country"</span>: {<span class="s">"id"</span>:<span class="s">"CZ"</span>,<span class="s">"value"</span>:<span class="s">"Czech Republic"</span>},
      <span class="s">"value"</span>:<span class="s">"16.6567773464055"</span>,<span class="s">"decimal"</span>:<span class="s">"1"</span>,<span class="s">"date"</span>:<span class="s">"2010"</span>} ] ]
</code></pre></td></tr></table>
<p>The document is formed by an array that contains a record as the first element
and a collection of data points as the second element. The following code
reads the document and parses it:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">value</span> <span class="o">=</span> <span class="i">JsonValue</span><span class="o">.</span><span class="i">Load</span>(<span class="k">__SOURCE_DIRECTORY__</span> <span class="o">+</span> <span class="s">&quot;../../data/WorldBank.json&quot;</span>)
</code></pre></td>
</tr>
</table>
<p>Note that we can also load the data directly from the web, and there's an
asynchronous version available too:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">wbReq</span> <span class="o">=</span> 
  <span class="s">&quot;http://api.worldbank.org/country/cz/indicator/&quot;</span> <span class="o">+</span> 
  <span class="s">&quot;GC.DOD.TOTL.GD.ZS?format=json&quot;</span>

<span class="k">let</span> <span class="i">valueAsync</span> <span class="o">=</span> 
  <span class="i">JsonValue</span><span class="o">.</span><span class="i">AsyncLoad</span>(<span class="i">wbReq</span>)
</code></pre></td>
</tr>
</table>
<p>To split the top-level array into the first record (with overall information)
and the collection of data points, we use pattern matching and match the <code>value</code>
against the <code>JsonValue.Array</code> constructor:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">match</span> <span class="i">value</span> <span class="k">with</span>
| <span class="i">JsonValue</span><span class="o">.</span><span class="i">Array</span> [| <span class="i">info</span>; <span class="i">data</span> |] <span class="k">-&gt;</span>
    <span class="c">// Print overall information</span>
    <span class="k">let</span> <span class="i">page</span>, <span class="i">pages</span>, <span class="i">total</span> <span class="o">=</span> <span class="i">info</span><span class="o">?</span><span class="i">page</span>, <span class="i">info</span><span class="o">?</span><span class="i">pages</span>, <span class="i">info</span><span class="o">?</span><span class="i">total</span>
    <span class="i">printfn</span> 
      <span class="s">&quot;Showing page %d of %d. Total records %d&quot;</span> 
      (<span class="i">page</span><span class="o">.</span><span class="i">AsInteger</span>()) (<span class="i">pages</span><span class="o">.</span><span class="i">AsInteger</span>()) (<span class="i">total</span><span class="o">.</span><span class="i">AsInteger</span>())
    
    <span class="c">// Print every non-null data point</span>
    <span class="k">for</span> <span class="i">record</span> <span class="k">in</span> <span class="i">data</span> <span class="k">do</span>
      <span class="k">if</span> <span class="i">record</span><span class="o">?</span><span class="i">value</span> <span class="o">&lt;&gt;</span> <span class="i">JsonValue</span><span class="o">.</span><span class="i">Null</span> <span class="k">then</span>
        <span class="i">printfn</span> <span class="s">&quot;%d: %f&quot;</span> (<span class="i">record</span><span class="o">?</span><span class="i">date</span><span class="o">.</span><span class="i">AsInteger</span>()) 
                         (<span class="i">record</span><span class="o">?</span><span class="i">value</span><span class="o">.</span><span class="i">AsFloat</span>())
| _ <span class="k">-&gt;</span> <span class="i">printfn</span> <span class="s">&quot;failed&quot;</span>
</code></pre></td>
</tr>
</table>
<p>The <code>value</code> property of a data point is not always available - as demonstrated
above, the value may be <code>null</code>. In that case, we want to skip the data point.
To check whether the property is <code>null</code> we simply compare it with <code>JsonValue.Null</code>.</p>
<p>Also note that the <code>date</code> and <code>value</code> properties are formatted as strings
in the source file (e.g. <code>"1990"</code>) instead of numbers (e.g. <code>1990</code>). When you try
accessing the value as an integer or float, the <code>JsonValue</code> automatically parses
the string into the desired format. In general, the API attempts to be as tolerant
as possible when parsing the file.</p>
<h2>Related articles</h2>
<ul>
<li>
<a href="JsonProvider.html">F# Data: JSON Type Provider</a> - discusses a F# type provider
that provides type-safe access to JSON data
</li>
<li>
<a href="WorldBank.html">F# Data: WorldBank Provider</a> - the WorldBank type provider
can be used to easily access data from the WorldBank
</li>
<li><a href="../reference/fsharp-data-jsonvalue.html">API Reference: JsonValue discriminated union</a></li>
<li><a href="../reference/fsharp-data-jsonextensions.html">API Reference: JsonExtensions module</a></li>
</ul>


        </div>
        <div class="span3">
          <a href="/FSharp.Data/index.html">
            <img src="/FSharp.Data/images/logo.png" style="width:140px;height:140px;margin:10px 0px 0px 35px;border-style:none;" />
          </a>

          <ul class="nav nav-list" id="menu">

            <li class="nav-header">
              <a href="/FSharp.Data/ja/index.html" class="nflag"><img src="/FSharp.Data/images/ja.png" /></a>
              <a href="/FSharp.Data/index.html" class="nflag nflag2"><img src="/FSharp.Data/images/en.png" /></a>
              F# Data
            </li>

            <li class="divider"></li>

            <li><a href="https://nuget.org/packages/FSharp.Data"><img src="http://img.shields.io/nuget/v/FSharp.Data.svg?style=flat" /></a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data">Source Code on GitHub</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/LICENSE.md">License (Apache 2.0)</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/RELEASE_NOTES.md">Release Notes</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/CONTRIBUTING.md">Contributing to F# Data</a></li>
            
            <li class="nav-header">Documentation</li>

            <li><a href="/FSharp.Data/index.html">Introduction</a></li>

            <li class="divider"></li>

            <li><a href="/FSharp.Data/library/CsvProvider.html">CSV Type Provider</a></li>
            <li><a href="/FSharp.Data/library/HtmlProvider.html">HTML Type Provider</a></li>
            <li><a href="/FSharp.Data/library/JsonProvider.html">JSON Type Provider</a></li>
            <li><a href="/FSharp.Data/library/XmlProvider.html">XML Type Provider</a></li>
            <li><a href="/FSharp.Data/library/WorldBank.html">WorldBank Provider</a></li>

            <li class="divider"></li>

            <li><a href="/FSharp.Data/library/Http.html">HTTP Utilities</a></li>
            <li><a href="/FSharp.Data/library/CsvFile.html">CSV Parser</a></li>
            <li><a href="/FSharp.Data/library/HtmlParser.html">HTML Parser</a></li>
            <li><a href="/FSharp.Data/library/HtmlCssSelectors.html">HTML CSS Selectors</a></li>
            <li><a href="/FSharp.Data/library/JsonValue.html">JSON Parser</a></li>

            <li class="nav-header">Tutorials</li>

            <li><a href="/FSharp.Data/tutorials/JsonToXml.html">Converting between JSON and XML</a></li>
            <li><a href="/FSharp.Data/tutorials/JsonAnonymizer.html">Anonymizing JSON</a></li>

            <li class="nav-header">Reference</li>

            <li><a href="/FSharp.Data/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/fsharp/FSharp.Data"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
  </html>