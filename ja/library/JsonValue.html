<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>F# Data: JSON パーサーおよびリーダー
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The F# Data library implements type providers for working with structured file formats (CSV, HTML, JSON and XML) and for accessing the WorldBank data. It also includes helpers for parsing CSV, HTML and JSON files, and for sending HTTP requests.">
    <meta name="author" content="Tomas Petricek; Gustavo Guerra">

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/style.css" />
    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/fsdata.css" />
    <script type="text/javascript" src="/FSharp.Data/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="https://bluemountaincapital.github.io/Deedle"><img height="16" width="16" src="/images/Deedle.png" /> Deedle</a></li>
          <li><a href="https://bluemountaincapital.github.io/FSharpRProvider"><img height=" 16" width="16" src="/images/FSharpRProvider.png" /> R Provider</a></li>
          <li><a href="https://fsharp.github.io/FSharp.Charting/"><img height="16" width="16" src="/images/FSharp.Charting.png" /> F# Charting</a></li>
          <li><a href="https://fsprojects.github.io/FSharp.Data.Toolbox"><img height="16" width="16" src="/images/FSharp.Data.Toolbox.png" /> F# Data Toolbox</a></li>
        </ul>
        <h3 class="muted"><a href="/FSharp.Data/ja/index.html">F# Data</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1>F# Data: JSON パーサーおよびリーダー</h1>
<p>F#の <a href="JsonProvider.html">JSON 型プロバイダー</a> はF#で作成された
効率の良いJSONパーサーを元にしています。
このパーサーは <a href="http://fsharp3sample.codeplex.com">F# 3.0 Sample Pack</a>
内にあるJSONパーサーを元にしていますが、
F# Dataでは値を動的にアクセスできるようにするための単純なAPIが追加されています。</p>
<p>厳密に定義されたJSONドキュメントを処理する場合、
<a href="JsonProvider.html">型プロバイダー</a> を使うと簡単なのですが、
動的に処理するようなシナリオであったり、
単純なスクリプトを手軽に用意したいような場合には
パーサーを使ったほうが簡単でしょう。</p>
<h2>JSONドキュメントの読み取り</h2>
<p>サンプルとなるJSONドキュメントを読み取るには
(F# Interactiveの場合)<code>FSharp.Data.dll</code> ライブラリへの参照を追加するか、
プロジェクトで参照を追加します。</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;../../../../bin/FSharp.Data.dll&quot;</span>
<span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Data</span>
</code></pre></td>
</tr>
</table>
<p><code>FSharp.Data</code> 名前空間にある <code>JsonValue</code> 型を使うと、
以下のようにしてJSON形式の文字列をパースできます：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">info</span> <span class="o">=</span>
  <span class="i">JsonValue</span><span class="o">.</span><span class="i">Parse</span>(<span class="s">&quot;&quot;&quot; </span>
<span class="s">    { &quot;name&quot;: &quot;Tomas&quot;, &quot;born&quot;: 1985,</span>
<span class="s">      &quot;siblings&quot;: [ &quot;Jan&quot;, &quot;Alexander&quot; ] } &quot;&quot;&quot;</span>)
</code></pre></td>
</tr>
</table>
<p><code>JsonValue</code> 型は <code>Record</code> や <code>Collection</code> などのケースを持った判別共用体なので
パターンマッチを使ってパース後の値の構造を調査することができます。</p>
<h2>JSON用拡張機能を使用する</h2>
<p>ここではすべての機能を紹介しません。
その代わり、 <code>FSharp.Data.JsonExtensions</code> 名前空間をオープンすることで
利用できるようになるいくつかの拡張機能について説明します。
この名前空間をオープンすると、以下のような記述ができるようになります：</p>
<ul>
<li><code>value.AsBoolean()</code> は値が <code>true</code> または <code>false</code> の場合にブール値を返します。</li>
<li>
<code>value.AsInteger()</code> は値が数値型で、整数として変換可能であれば整数値を返します。
同様に <code>value.AsInteger64()</code> <code>value.AsDecimal()</code> <code>value.AsFloat()</code>
といったものもあります。
</li>
<li><code>value.AsString()</code> は値を文字列として返します。</li>
<li>
<code>value.AsDateTime()</code> は値を <a href="http://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> か、
1970/1/1からのミリ秒を含んだJSON形式の <code>\/Date(...)\/</code> でパースして
<code>DateTime</code> を返します。
</li>
<li><code>value.AsGuid()</code> は値を <code>Guid</code> としてパースします。</li>
<li>
<code>value?child</code> は <code>child</code> という名前のレコードメンバーを
取得するための動的演算子です。
あるいは <code>value.GetProperty(child)</code> やインデクサ <code>value.[child]</code>
を使うこともできます。
</li>
<li>
<code>value.TryGetProperty(child)</code> はレコードメンバーを安全に取得できます
(もしメンバーが値無しあるいはレコードではなかった場合、 <code>TryGetProperty</code> は
<code>None</code> を返します)。
</li>
<li>
<code>[ for v in value -&gt; v ]</code> とすると <code>value</code> をコレクションとして扱い、
含まれている要素を走査します。
また、 <code>value.AsArray()</code> とすると、すべての要素を配列として取得できます。
</li>
<li><code>value.Properties()</code> はレコードノードの全プロパティのリストを返します。</li>
<li>
<code>value.InnerText()</code> はすべてのテキストあるいは配列内のテキスト
(たとえば複数行文字列を表すデータ)を連結します
</li>
</ul>
<p>数値または日付データとしてパースする( <code>AsFloat</code> や <code>AsDateTime</code> などの)メソッドには
省略可能な引数としてカルチャを指定出来ます。</p>
<p>以下のコードはサンプルで指定したJSONの値を処理する方法の一例です：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Data</span><span class="o">.</span><span class="i">JsonExtensions</span>

<span class="c">// 名前と誕生日を表示</span>
<span class="k">let</span> <span class="i">n</span> <span class="o">=</span> <span class="i">info</span><span class="o">?</span><span class="i">name</span>
<span class="i">printfn</span> <span class="s">&quot;%s (%d)&quot;</span> (<span class="i">info</span><span class="o">?</span><span class="i">name</span><span class="o">.</span><span class="i">AsString</span>()) (<span class="i">info</span><span class="o">?</span><span class="i">born</span><span class="o">.</span><span class="i">AsInteger</span>())

<span class="c">// 兄弟姉妹全員の名前を表示</span>
<span class="k">for</span> <span class="i">sib</span> <span class="k">in</span> <span class="i">info</span><span class="o">?</span><span class="i">siblings</span> <span class="k">do</span>
  <span class="i">printfn</span> <span class="s">&quot;%s&quot;</span> (<span class="i">sib</span><span class="o">.</span><span class="i">AsString</span>())
</code></pre></td>
</tr>
</table>
<p><code>JsonValue</code> 型は実際には <code>IEnumerable&lt;'T&gt;</code> インターフェイスを
実装しているわけではありません(つまり <code>Seq.xyz</code> 関数に渡す事はできません)。
<code>GetEnumerator</code> だけが定義されているため、シーケンス式内や
<code>for</code> ループで使うことができるというわけです。</p>
<h2>WorldBankからのレスポンスをパースする</h2>
<p>もう少し複雑な例として、WorldBankへのリクエストに対する
レスポンスデータ <a href="../../data/WorldBank.json"><code>data/WorldBank.json</code></a> を
サンプルドキュメントにしてみます。
(より便利な方法としては <a href="WorldBank.html">型プロバイダー</a> を使って
WorldBankにアクセスすることもできます)。
このドキュメントは以下のようになっています：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="js">[ { <span class="s">"page"</span>: <span class="n">1</span>, <span class="s">"pages"</span>: <span class="n">1</span>, <span class="s">"total"</span>: <span class="n">53</span> },
  [ { <span class="s">"indicator"</span>: {<span class="s">"value"</span>: <span class="s">"Central government debt, total (% of GDP)"</span>},
      <span class="s">"country"</span>: {<span class="s">"id"</span>:<span class="s">"CZ"</span>,<span class="s">"value"</span>:<span class="s">"Czech Republic"</span>},
      <span class="s">"value"</span>:<span class="k">null</span>,<span class="s">"decimal"</span>:<span class="s">"1"</span>,<span class="s">"date"</span>:<span class="s">"2000"</span>},
    { <span class="s">"indicator"</span>: {<span class="s">"value"</span>: <span class="s">"Central government debt, total (% of GDP)"</span>},
      <span class="s">"country"</span>: {<span class="s">"id"</span>:<span class="s">"CZ"</span>,<span class="s">"value"</span>:<span class="s">"Czech Republic"</span>},
      <span class="s">"value"</span>:<span class="s">"16.6567773464055"</span>,<span class="s">"decimal"</span>:<span class="s">"1"</span>,<span class="s">"date"</span>:<span class="s">"2010"</span>} ] ]
</code></pre></td></tr></table>
<p>このように、全体としては配列になっていて、
1番目の要素にはレコード、2番目の要素にはデータ点のコレクションが
含まれた形式になっています。
このドキュメントは以下のようにして読み取りおよびパースできます：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">value</span> <span class="o">=</span> <span class="i">JsonValue</span><span class="o">.</span><span class="i">Load</span>(<span class="k">__SOURCE_DIRECTORY__</span> <span class="o">+</span> <span class="s">&quot;../../../data/WorldBank.json&quot;</span>)
</code></pre></td>
</tr>
</table>
<p>なおWeb上から直接データを読み取ることもできます。
また、読み取りを非同期的に実行するバージョンもあります：
*</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">valueAsync</span> <span class="o">=</span> <span class="i">JsonValue</span><span class="o">.</span><span class="i">AsyncLoad</span>(<span class="s">&quot;http://api.worldbank.org/country/cz/indicator/GC.DOD.TOTL.GD.ZS?format=json&quot;</span>)
</code></pre></td>
</tr>
</table>
<p>最上位の配列を1番目の(概要を含んだ)レコードとデータ点のコレクションに分けるためには
<code>value</code> に対してパターンマッチを使って
<code>Jsonvalue.Array</code> のコンストラクタとマッチするかどうか調べます：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">match</span> <span class="i">value</span> <span class="k">with</span>
| <span class="i">JsonValue</span><span class="o">.</span><span class="i">Array</span> [| <span class="i">info</span>; <span class="i">data</span> |] <span class="k">-&gt;</span>
    <span class="c">// 概要を表示</span>
    <span class="k">let</span> <span class="i">page</span>, <span class="i">pages</span>, <span class="i">total</span> <span class="o">=</span> <span class="i">info</span><span class="o">?</span><span class="i">page</span>, <span class="i">info</span><span class="o">?</span><span class="i">pages</span>, <span class="i">info</span><span class="o">?</span><span class="i">total</span>
    <span class="i">printfn</span> 
      <span class="s">&quot;%d ページ中の %d ページ目を表示中。 全体のレコード数は %d&quot;</span> 
      (<span class="i">pages</span><span class="o">.</span><span class="i">AsInteger</span>()) (<span class="i">page</span><span class="o">.</span><span class="i">AsInteger</span>()) (<span class="i">total</span><span class="o">.</span><span class="i">AsInteger</span>())
    
    <span class="c">// 非nullのデータ点をそれぞれ表示</span>
    <span class="k">for</span> <span class="i">record</span> <span class="k">in</span> <span class="i">data</span> <span class="k">do</span>
      <span class="k">if</span> <span class="i">record</span><span class="o">?</span><span class="i">value</span> <span class="o">&lt;&gt;</span> <span class="i">JsonValue</span><span class="o">.</span><span class="i">Null</span> <span class="k">then</span>
        <span class="i">printfn</span> <span class="s">&quot;%d: %f&quot;</span> (<span class="i">record</span><span class="o">?</span><span class="i">date</span><span class="o">.</span><span class="i">AsInteger</span>()) 
                         (<span class="i">record</span><span class="o">?</span><span class="i">value</span><span class="o">.</span><span class="i">AsFloat</span>())
| _ <span class="k">-&gt;</span> <span class="i">printfn</span> <span class="s">&quot;失敗しました&quot;</span>
</code></pre></td>
</tr>
</table>
<p>データ点の <code>value</code> プロパティは常に使用できるわけではありません。
直前で説明してある通り、この値は <code>null</code> になることがあります。
その場合にはデータ点をスキップします。
プロパティが <code>null</code> かどうか調べる場合は単に <code>JsonValue.Null</code> と
比較するだけです。</p>
<p>また <code>date</code> と <code>value</code> のプロパティは元のファイルでは( <code>1990</code> のような)数値ではなく、
( <code>"1990"</code> のような)文字列形式になっている点に注意してください。
この値を int または float として取得しようとすると、
<code>JsonValue</code> は自動的に文字列を特定の形式になるようにパースします。
一般的にはこのAPIがファイルをパースする場合、
できるだけ寛容に値を受け入れるようになっています。</p>
<h2>関連する記事</h2>
<ul>
<li>
<a href="JsonProvider.html">F# Data: JSON 型プロバイダー</a> -
型安全な方法でJSONデータにアクセスする機能を持った
F# 型プロバイダーについて説明しています。
</li>
<li>
<a href="WorldBank.html">F# Data: WorldBank プロバイダー</a> -
WorldBank 型プロバイダーを使うとWorldBankから受け取ったデータを
簡単に処理出来るようになります。
</li>
<li><a href="../../reference/fsharp-data-jsonvalue.html">API リファレンス: JsonValue 判別共用体</a></li>
<li><a href="../../reference/fsharp-data-jsonextensions.html">API リファレンス: JsonExtensions モジュール</a></li>
</ul>


        </div>
        <div class="span3">
          <a href="/FSharp.Data/ja/index.html">
            <img src="/FSharp.Data/images/logo.png" style="width:140px;height:140px;margin:10px 0px 0px 35px;border-style:none;" />
          </a>

          <ul class="nav nav-list" id="menu">
            <li class="nav-header">
              <a href="/FSharp.Data/ja/index.html" class="nflag"><img src="/FSharp.Data/images/ja.png" /></a>
              <a href="/FSharp.Data/index.html" class="nflag nflag2"><img src="/FSharp.Data/images/en.png" /></a>
              F# Data
            </li>
            <li class="divider"></li>
            <li><a href="https://nuget.org/packages/FSharp.Data">NuGet経由でライブラリを取得</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data">GitHub上のソースコード</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/LICENSE.md">License (Apache 2.0)</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/RELEASE_NOTES.md">リリースノート</a></li>
            <li><span>
                <a href="/FSharp.Data/ja/contributing.html">F# Dataに貢献する</a>
                (<a href="http://github.com/fsharp/FSharp.Data/blob/master/CONTRIBUTING.md">En</a>)
                </span></li>
            
            <li class="nav-header">F# Data ライブラリ</li>
            <li><span>
                <a href="/FSharp.Data/ja/index.html">はじめに</a>
                (<a href="/FSharp.Data/index.html">En</a>)
                </span></li>
            <li class="divider"></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/JsonProvider.html">JSON 型プロバイダー</a>
                (<a href="/FSharp.Data/library/JsonProvider.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/XmlProvider.html">XML 型プロバイダー</a>
                (<a href="/FSharp.Data/library/XmlProvider.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/CsvProvider.html">CSV 型プロバイダー</a>
                (<a href="/FSharp.Data/library/CsvProvider.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/WorldBank.html">WorldBank プロバイダー</a>
                (<a href="/FSharp.Data/library/WorldBank.html">En</a>)
                </span></li>
            <li class="divider"></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/Http.html">HTTP ユーティリティ</a>
                (<a href="/FSharp.Data/library/Http.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/CsvFile.html">CSV パーサーおよびリーダー</a>
                (<a href="/FSharp.Data/library/CsvFile.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/JsonValue.html">JSON パーサーおよびリーダー</a>
                (<a href="/FSharp.Data/library/JsonValue.html">En</a>)
                </span></li>

            <li class="nav-header">チュートリアル</li>
            <li><span>
                <a href="/FSharp.Data/ja/tutorials/JsonToXml.html">JSONとXMLの相互変換</a>
                (<a href="/FSharp.Data/tutorials/JsonToXml.html">En</a>)
                </span></li>

            <li><span>
                <a href="/FSharp.Data/ja/tutorials/JsonAnonymizer.html">JSONの匿名化</a>
                (<a href="/FSharp.Data/tutorials/JsonAnonymizer.html">En</a>)
                </span></li>

            <li class="nav-header">リファレンス</li>
            <li><span>
                <a href="/FSharp.Data/reference/index.html">API リファレンス (En)</a>
                </span></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/fsharp/FSharp.Data"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
  </html>