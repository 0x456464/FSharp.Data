<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>F# Data: WorldBank プロバイダー
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The F# Data library implements type providers for working with structured file formats (CSV, HTML, JSON and XML) and for accessing the WorldBank data. It also includes helpers for parsing CSV, HTML and JSON files, and for sending HTTP requests.">
    <meta name="author" content="Tomas Petricek; Gustavo Guerra">

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/style.css" />
    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/fsdata.css" />
    <script type="text/javascript" src="/FSharp.Data/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="https://bluemountaincapital.github.io/Deedle"><img height="16" width="16" src="/images/Deedle.png" /> Deedle</a></li>
          <li><a href="https://bluemountaincapital.github.io/FSharpRProvider"><img height=" 16" width="16" src="/images/FSharpRProvider.png" /> R Provider</a></li>
          <li><a href="https://fsharp.github.io/FSharp.Charting/"><img height="16" width="16" src="/images/FSharp.Charting.png" /> F# Charting</a></li>
          <li><a href="https://fsprojects.github.io/FSharp.Data.Toolbox"><img height="16" width="16" src="/images/FSharp.Data.Toolbox.png" /> F# Data Toolbox</a></li>
        </ul>
        <h3 class="muted"><a href="/FSharp.Data/ja/index.html">F# Data</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1>F# Data: WorldBank プロバイダー</h1>
<p><a href="http://www.worldbank.org">世界銀行</a> (World Bank)は世界中の発展途上国に対して、
経済的かつ技術的な支援を行っている国際組織です。
また、世界銀行は活動の一環として世界中の各国における発展指標や
その他のデータを収集しています。
<a href="http://data.worldbank.org/">data catalog</a> のページではプログラムからも
アクセスできる8000以上の指標が公開されています。</p>
<p>WorldBank 型プロバイダーを使うと、F#プログラムやスクリプトから型安全かつ
簡単な方法でWorldBankのデータにアクセスできるようになります。
このドキュメントはこの型プロバイダーの基本的な部分のみ説明しています。
WorldBank 型プロバイダーは <a href="http://www.tryfsharp.org">Try F#</a> の
Webサイトにある"Data Science" のチュートリアルでも使われているため、
そちらも参考にするとよいでしょう。</p>
<h2>型プロバイダーの基本</h2>
<p>以下の例では(F# Interactive上で) <code>FSharp.Data.dll</code> ライブラリを読み込んだ後、
<code>GetDataContext</code> メソッドを使ってWorldBankへの接続を初期化し、
イギリスで大学に進学した人口の割合を受信しています；</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;../../../../bin/FSharp.Data.dll&quot;</span>
<span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Data</span>

<span class="k">let</span> <span class="i">data</span> <span class="o">=</span> <span class="i">WorldBankData</span><span class="o">.</span><span class="i">GetDataContext</span>()

<span class="i">data</span>
  <span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">``United Kingdom``</span>
  <span class="o">.</span><span class="i">Indicators</span><span class="o">.</span><span class="i">``Gross enrolment ratio, tertiary, both sexes (%)``</span>
<span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">maxBy</span> <span class="i">fst</span>
</code></pre></td>
</tr>
</table>
<p>データコンテキストが生成されると、WorldBank 型プロバイダーは
世界銀行で把握されているすべての国のリスト、および
利用可能なすべての指針のリストを受信します。
それぞれはプロパティとして参照できるようになっているため、
自動コンプリートの候補から様々なデータソースが利用できることが確認できるでしょう。
多くの指標には長い名前がつけられているため、
名前を <code>\</code>`` で囲む必要があります。</p>
<p><code>Gross enrolment ratio, tertiary, both sexes (%)</code> プロパティの結果は
異なる年毎の値のシーケンスです。
<code>Seq.maxBy fst</code> とすることで直近で利用可能な最新のデータを取得できます。</p>
<h3>世界銀行のデータをチャート表示する</h3>
<p><a href="http://fsharp.github.io/FSharp.Charting/">FSharp.Charting</a> ライブラリを使うと
大学進学率の変遷を簡単に図表にできます：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#load</span> <span class="s">&quot;../../../../packages/FSharp.Charting/lib/net45/FSharp.Charting.fsx&quot;</span>
<span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Charting</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">data</span><span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">``United Kingdom``</span>
    <span class="o">.</span><span class="i">Indicators</span><span class="o">.</span><span class="i">``Gross enrolment ratio, tertiary, both sexes (%)``</span>
<span class="o">|&gt;</span> <span class="i">Chart</span><span class="o">.</span><span class="i">Line</span>
</code></pre></td>
</tr>
</table>
<p><code>Chart.Line</code> 関数はXとYの値ペアのシーケンスを受け取ります。
そのため、世界銀行から受信したデータセットをそのまま渡せば
Xが年、Yがその年の値になったチャートが作成できます。</p>
<p><img src="/FSharp.Data/images/chart5.png" alt="Chart" /></p>
<h2>世界銀行のデータを非同期的に使う</h2>
<p>非常に大量のデータをダウンロードする必要がある場合、
あるいは呼び出し元をブロックせずに処理を実行した場合には、
F#の非同期ワークフローを使って操作ができればいいなと思うのではないでしょうか。
F# Dataライブラリには様々なstatic引数を受け取るような
<code>WorldBankDataProvider</code> 型があります。
引数 <code>Asyncronous</code> を <code>true</code> にすると、
すべての操作を非同期的に実行するような型が
型プロバイダーによって生成されます：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">WorldBank</span> <span class="o">=</span> <span class="i">WorldBankDataProvider</span><span class="o">&lt;</span><span class="s">&quot;World Development Indicators&quot;</span>, <span class="i">Asynchronous</span><span class="o">=</span><span class="k">true</span><span class="o">&gt;</span>
<span class="i">WorldBank</span><span class="o">.</span><span class="i">GetDataContext</span>()
</code></pre></td>
</tr>
</table>
<p>上のコードではデータソース(一般的に利用可能な指標のコレクション)の名前として
"World Development Indicators" を指定して、オプション引数 <code>Asynchronous</code> に
<code>true</code> を設定しています。
そうするとたとえば <code>Gross enrolment ratio, tertiary, both sexes (%)</code> などのプロパティが
<code>Async&lt;(int * int)[]&gt;</code> になります。
これはつまり非同期的に処理を始めることができ、最終的にデータを生成するような
操作であることを示しています。</p>
<h3>データを並列にダウンロードする</h3>
<p>非同期バージョンの型プロバイダーのデモとして、
多数の国における大学進学率を並列にダウンロートしてみます。
まずデータコンテキストを作成した後に、
対象とする国を配列として定義します：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">wb</span> <span class="o">=</span> <span class="i">WorldBank</span><span class="o">.</span><span class="i">GetDataContext</span>()

<span class="c">// 対象とする国のリストを作成</span>
<span class="k">let</span> <span class="i">countries</span> <span class="o">=</span> 
 [| <span class="i">wb</span><span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">``Arab World``</span>
    <span class="i">wb</span><span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">``European Union``</span>
    <span class="i">wb</span><span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">Australia</span>
    <span class="i">wb</span><span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">Brazil</span>
    <span class="i">wb</span><span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">Canada</span>
    <span class="i">wb</span><span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">Chile</span>
    <span class="i">wb</span><span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">``Czech Republic``</span>
    <span class="i">wb</span><span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">Denmark</span>
    <span class="i">wb</span><span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">France</span>
    <span class="i">wb</span><span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">Greece</span>
    <span class="i">wb</span><span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">``Low income``</span>
    <span class="i">wb</span><span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">``High income``</span>
    <span class="i">wb</span><span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">``United Kingdom``</span>
    <span class="i">wb</span><span class="o">.</span><span class="i">Countries</span><span class="o">.</span><span class="i">``United States``</span> |]
</code></pre></td>
</tr>
</table>
<p>データを並列にダウンロードするには、非同期計算のリストを作成した後、
それらを <code>Async.Parallel</code> で組み合わせ、
(1つになった)計算を実行してすべてのダウンロード処理を行います：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[ <span class="k">for</span> <span class="i">c</span> <span class="k">in</span> <span class="i">countries</span> <span class="k">-&gt;</span>
    <span class="i">c</span><span class="o">.</span><span class="i">Indicators</span><span class="o">.</span><span class="i">``Gross enrolment ratio, tertiary, both sexes (%)``</span> ]
<span class="o">|&gt;</span> <span class="i">Async</span><span class="o">.</span><span class="i">Parallel</span>
<span class="o">|&gt;</span> <span class="i">Async</span><span class="o">.</span><span class="i">RunSynchronously</span>
<span class="o">|&gt;</span> <span class="i">Array</span><span class="o">.</span><span class="i">map</span> <span class="i">Chart</span><span class="o">.</span><span class="i">Line</span>
<span class="o">|&gt;</span> <span class="i">Chart</span><span class="o">.</span><span class="i">Combine</span>
</code></pre></td>
</tr>
</table>
<p>上のコードは単に <code>Async.RunSynchronously</code> を使ってダウンロードするだけではなく、
それぞれのデータセットから1つの折れ線チャートを出力して、
各チャートを <code>Chart.Combine</code> で1つの総合チャートにしています。</p>
<p><img src="/FSharp.Data/images/chart6.png" alt="Chart" /></p>
<h2>関連する記事</h2>
<ul>
<li>
<a href="http://www.tryfsharp.org/Learn/data-science">Try F#: Data Science</a> -
Try F# の Data Science チュートリアルにはFreebase 型プロバイダーを使った
様々な例があります。
</li>
<li><a href="../../reference/fsharp-data-worldbankdataprovider.html">API リファレンス: WorldBankDataProvider 型プロバイダー</a></li>
</ul>


        </div>
        <div class="span3">
          <a href="/FSharp.Data/ja/index.html">
            <img src="/FSharp.Data/images/logo.png" style="width:140px;height:140px;margin:10px 0px 0px 35px;border-style:none;" />
          </a>

          <ul class="nav nav-list" id="menu">
            <li class="nav-header">
              <a href="/FSharp.Data/ja/index.html" class="nflag"><img src="/FSharp.Data/images/ja.png" /></a>
              <a href="/FSharp.Data/index.html" class="nflag nflag2"><img src="/FSharp.Data/images/en.png" /></a>
              F# Data
            </li>
            <li class="divider"></li>
            <li><a href="https://nuget.org/packages/FSharp.Data">NuGet経由でライブラリを取得</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data">GitHub上のソースコード</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/LICENSE.md">License (Apache 2.0)</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/RELEASE_NOTES.md">リリースノート</a></li>
            <li><span>
                <a href="/FSharp.Data/ja/contributing.html">F# Dataに貢献する</a>
                (<a href="http://github.com/fsharp/FSharp.Data/blob/master/CONTRIBUTING.md">En</a>)
                </span></li>
            
            <li class="nav-header">F# Data ライブラリ</li>
            <li><span>
                <a href="/FSharp.Data/ja/index.html">はじめに</a>
                (<a href="/FSharp.Data/index.html">En</a>)
                </span></li>
            <li class="divider"></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/JsonProvider.html">JSON 型プロバイダー</a>
                (<a href="/FSharp.Data/library/JsonProvider.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/XmlProvider.html">XML 型プロバイダー</a>
                (<a href="/FSharp.Data/library/XmlProvider.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/CsvProvider.html">CSV 型プロバイダー</a>
                (<a href="/FSharp.Data/library/CsvProvider.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/WorldBank.html">WorldBank プロバイダー</a>
                (<a href="/FSharp.Data/library/WorldBank.html">En</a>)
                </span></li>
            <li class="divider"></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/Http.html">HTTP ユーティリティ</a>
                (<a href="/FSharp.Data/library/Http.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/CsvFile.html">CSV パーサーおよびリーダー</a>
                (<a href="/FSharp.Data/library/CsvFile.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/JsonValue.html">JSON パーサーおよびリーダー</a>
                (<a href="/FSharp.Data/library/JsonValue.html">En</a>)
                </span></li>

            <li class="nav-header">チュートリアル</li>
            <li><span>
                <a href="/FSharp.Data/ja/tutorials/JsonToXml.html">JSONとXMLの相互変換</a>
                (<a href="/FSharp.Data/tutorials/JsonToXml.html">En</a>)
                </span></li>

            <li><span>
                <a href="/FSharp.Data/ja/tutorials/JsonAnonymizer.html">JSONの匿名化</a>
                (<a href="/FSharp.Data/tutorials/JsonAnonymizer.html">En</a>)
                </span></li>

            <li class="nav-header">リファレンス</li>
            <li><span>
                <a href="/FSharp.Data/reference/index.html">API リファレンス (En)</a>
                </span></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/fsharp/FSharp.Data"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
  </html>