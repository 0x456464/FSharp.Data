<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>F# Data: CSV 型プロバイダー
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The F# Data library implements type providers for working with structured file formats (CSV, HTML, JSON and XML) and for accessing the WorldBank data. It also includes helpers for parsing CSV, HTML and JSON files, and for sending HTTP requests.">
    <meta name="author" content="Tomas Petricek; Gustavo Guerra">

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/style.css" />
    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/fsdata.css" />
    <script type="text/javascript" src="/FSharp.Data/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="https://bluemountaincapital.github.io/Deedle"><img height="16" width="16" src="/images/Deedle.png" /> Deedle</a></li>
          <li><a href="https://bluemountaincapital.github.io/FSharpRProvider"><img height=" 16" width="16" src="/images/FSharpRProvider.png" /> R Provider</a></li>
          <li><a href="https://fsharp.github.io/FSharp.Charting/"><img height="16" width="16" src="/images/FSharp.Charting.png" /> F# Charting</a></li>
          <li><a href="https://fsprojects.github.io/FSharp.Data.Toolbox"><img height="16" width="16" src="/images/FSharp.Data.Toolbox.png" /> F# Data Toolbox</a></li>
        </ul>
        <h3 class="muted"><a href="/FSharp.Data/ja/index.html">F# Data</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1>F# Data: CSV 型プロバイダー</h1>
<p>この記事ではCSV 型プロバイダーを使って
静的に型付けされた方法でCSVファイルを扱う方法を紹介します。
この型プロバイダーは <a href="http://www.tryfsharp.org">Try F#</a> のWebサイトにある
"Financial Computing" のチュートリアルとよく似ています。
したがってそちらを参考にするともう少し多くの例が見つけられるでしょう。</p>
<p>CSV 型プロバイダーは入力としてサンプルとなるCSVを受け取り、
このサンプル内の列データを元にした型を生成します。
列の名前は1行目(ヘッダ行)が元になり、各列の型は2行目以降にあるデータから
推測されます。</p>
<h2>プロバイダーの基本</h2>
<p>この型プロバイダーは <code>FSharp.Data.Dll</code> アセンブリに含まれています。
このアセンブリが <code>../../../../bin</code> にあるとすると、
F# Interactiveでアセンブリを読み込むには以下のようにします：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;../../../../bin/FSharp.Data.dll&quot;</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">FSharp</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">Data</span>
</code></pre></td>
</tr>
</table>
<h3>株価をパースする</h3>
<p>Yahoo FinanceのWebサイトでは以下のような構造のCSV形式で
日単位の株価が公開されています
(より大きな例としては <a href="../../data/MSFT.csv"><code>data/MSFT.csv</code></a> ファイルを
参照してください)：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="text">Date,Open,High,Low,Close,Volume,Adj Close
2012-01-27,29.45,29.53,29.17,29.23,44187700,29.23
2012-01-26,29.61,29.70,29.40,29.50,49102800,29.50
2012-01-25,29.07,29.65,29.07,29.56,59231700,29.56
2012-01-24,29.47,29.57,29.18,29.34,51703300,29.34
</code></pre></td></tr></table>
<p>一般的なCSVファイルと同じく、1行目にはヘッダ(各列の名前)があり、
2行目以降にデータがあります。
このファイルを <code>CsvProvider</code> に指定すると、
静的に型付けされた方法でファイルの内容を参照できるようになります：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="t">Stocks</span> <span class="o">=</span> <span class="i">CsvProvider</span><span class="o">&lt;</span><span class="s">&quot;../../data/MSFT.csv&quot;</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>
<p>生成された型にはデータをロードするための2つのstaticメソッドがあります。
データが文字列の場合には <code>Parse</code> メソッドを使用します。
データがファイルやWeb上のリソースの場合には <code>Load</code> メソッドを使用します
(非同期バージョンの <code>AsyncLoad</code> メソッドもあります)。
型プロバイダーに指定するサンプル用の引数には
ローカルのパスだけではなく、Web上のURLを指定することもできます。
以下の例ではYahoo FinanceのWebサイトで実際に公開されているCSVファイルの
URLを使って <code>Load</code> メソッドを呼び出しています：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// 株価データをダウンロード</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">msft</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 5)" onmouseover="showTip(event, 'fs3', 5)" class="i">Stocks</span><span class="o">.</span><span class="i">Load</span>(<span class="s">&quot;http://www.google.com/finance/historical?q=MSFT&amp;output=csv&quot;</span>)

<span class="c">// 最新の行をチェックする。なお &#39;Date&#39; プロパティは</span>
<span class="c">// &#39;DateTime&#39; 型で、 &#39;Open&#39; プロパティは &#39;decimal&#39; 型であることに注意</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="i">firstRow</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 7)" onmouseover="showTip(event, 'fs4', 7)" class="i">msft</span><span class="o">.</span><span class="i">Rows</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs6', 8)" onmouseover="showTip(event, 'fs6', 8)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 9)" onmouseover="showTip(event, 'fs7', 9)" class="f">head</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 10)" onmouseover="showTip(event, 'fs8', 10)" class="i">lastDate</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs5', 11)" onmouseover="showTip(event, 'fs5', 11)" class="i">firstRow</span><span class="o">.</span><span class="i">Date</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs9', 12)" onmouseover="showTip(event, 'fs9', 12)" class="i">lastOpen</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs5', 13)" onmouseover="showTip(event, 'fs5', 13)" class="i">firstRow</span><span class="o">.</span><span class="i">Open</span>

<span class="c">// 株価を四本値形式で表示</span>
<span class="k">for</span> <span onmouseout="hideTip(event, 'fs10', 14)" onmouseover="showTip(event, 'fs10', 14)" class="i">row</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs4', 15)" onmouseover="showTip(event, 'fs4', 15)" class="i">msft</span><span class="o">.</span><span class="i">Rows</span> <span class="k">do</span>
  <span onmouseout="hideTip(event, 'fs11', 16)" onmouseover="showTip(event, 'fs11', 16)" class="f">printfn</span> <span class="s">&quot;HLOC: (</span><span class="pf">%A</span><span class="s">, </span><span class="pf">%A</span><span class="s">, </span><span class="pf">%A</span><span class="s">, </span><span class="pf">%A</span><span class="s">)&quot;</span> <span onmouseout="hideTip(event, 'fs10', 17)" onmouseover="showTip(event, 'fs10', 17)" class="i">row</span><span class="o">.</span><span class="i">High</span> <span onmouseout="hideTip(event, 'fs10', 18)" onmouseover="showTip(event, 'fs10', 18)" class="i">row</span><span class="o">.</span><span class="i">Low</span> <span onmouseout="hideTip(event, 'fs10', 19)" onmouseover="showTip(event, 'fs10', 19)" class="i">row</span><span class="o">.</span><span class="i">Open</span> <span onmouseout="hideTip(event, 'fs10', 20)" onmouseover="showTip(event, 'fs10', 20)" class="i">row</span><span class="o">.</span><span class="i">Close</span>
</code></pre></td>
</tr>
</table>
<blockquote>
<p>訳注：四本値とは高値、安値、始値、終値の4種の値段のこと</p>
</blockquote>
<p>生成された型にはCSVファイルのデータを行コレクションとして返す
<code>Rows</code> プロパティがあります。
ここでは <code>for</code> ループを使って各行を走査しています。
見て分かるように、行のための(生成された)型には <code>High</code> や <code>Low</code> 、
<code>Close</code> など、CSVファイルの各列に対応するプロパティがあります。</p>
<p>また、型プロバイダーが各列の型を推測していることも確認できます。
<code>Date</code> プロパティは(サンプルファイル中のデータが日付としてパースできるため)
<code>DateTime</code> 型として推測されていますが、一方で四本値はそれぞれ
<code>decimal</code> として推測されています。</p>
<h3>株価のチャート表示</h3>
<p><a href="http://fsharp.github.io/FSharp.Charting/">FSharp.Charting</a> ライブラリを使うと
上場からのMSFTの株価変化を単純な折れ線チャートとして描画できます：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// FSharp.Chartingの読み込み</span>
<span class="prep">#load</span> <span class="s">&quot;../../../../packages/FSharp.Charting/lib/net45/FSharp.Charting.fsx&quot;</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs12', 21)" onmouseover="showTip(event, 'fs12', 21)" class="i">System</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 22)" onmouseover="showTip(event, 'fs1', 22)" class="i">FSharp</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 23)" onmouseover="showTip(event, 'fs13', 23)" class="i">Charting</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// 株価をビジュアル化</span>
[ <span class="k">for</span> <span onmouseout="hideTip(event, 'fs10', 24)" onmouseover="showTip(event, 'fs10', 24)" class="i">row</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs4', 25)" onmouseover="showTip(event, 'fs4', 25)" class="i">msft</span><span class="o">.</span><span class="i">Rows</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs10', 26)" onmouseover="showTip(event, 'fs10', 26)" class="i">row</span><span class="o">.</span><span class="i">Date</span>, <span onmouseout="hideTip(event, 'fs10', 27)" onmouseover="showTip(event, 'fs10', 27)" class="i">row</span><span class="o">.</span><span class="i">Open</span> ]
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 28)" onmouseover="showTip(event, 'fs14', 28)" class="t">Chart</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 29)" onmouseover="showTip(event, 'fs15', 29)" class="i">FastLine</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>No value has been returned</code></pre></td></tr></table>
<p>もう1つ例として、先月のデータの詳細を確認できるように
<code>ローソク</code> (Candlestick)チャートにしてみます：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// 先月の株価を四本値形式で取得</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs16', 30)" onmouseover="showTip(event, 'fs16', 30)" class="i">recent</span> <span class="o">=</span> 
  [ <span class="k">for</span> <span onmouseout="hideTip(event, 'fs10', 31)" onmouseover="showTip(event, 'fs10', 31)" class="i">row</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs4', 32)" onmouseover="showTip(event, 'fs4', 32)" class="i">msft</span><span class="o">.</span><span class="i">Rows</span> <span class="k">do</span>
      <span class="k">if</span> <span onmouseout="hideTip(event, 'fs10', 33)" onmouseover="showTip(event, 'fs10', 33)" class="i">row</span><span class="o">.</span><span class="i">Date</span> <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs17', 34)" onmouseover="showTip(event, 'fs17', 34)" class="t">DateTime</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs18', 35)" onmouseover="showTip(event, 'fs18', 35)" class="i">Now</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 36)" onmouseover="showTip(event, 'fs19', 36)" class="f">AddDays</span>(<span class="o">-</span><span class="n">30.0</span>) <span class="k">then</span>
        <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs10', 37)" onmouseover="showTip(event, 'fs10', 37)" class="i">row</span><span class="o">.</span><span class="i">Date</span>, <span onmouseout="hideTip(event, 'fs10', 38)" onmouseover="showTip(event, 'fs10', 38)" class="i">row</span><span class="o">.</span><span class="i">High</span>, <span onmouseout="hideTip(event, 'fs10', 39)" onmouseover="showTip(event, 'fs10', 39)" class="i">row</span><span class="o">.</span><span class="i">Low</span>, <span onmouseout="hideTip(event, 'fs10', 40)" onmouseover="showTip(event, 'fs10', 40)" class="i">row</span><span class="o">.</span><span class="i">Open</span>, <span onmouseout="hideTip(event, 'fs10', 41)" onmouseover="showTip(event, 'fs10', 41)" class="i">row</span><span class="o">.</span><span class="i">Close</span> ]
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// ローソクチャートを使って株価をビジュアル化</span>
<span onmouseout="hideTip(event, 'fs14', 42)" onmouseover="showTip(event, 'fs14', 42)" class="t">Chart</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 43)" onmouseover="showTip(event, 'fs20', 43)" class="i">Candlestick</span>(<span onmouseout="hideTip(event, 'fs16', 44)" onmouseover="showTip(event, 'fs16', 44)" class="i">recent</span>)<span class="o">.</span><span class="i">WithYAxis</span>(<span class="i">Min</span> <span class="o">=</span> <span class="n">40.0</span>, <span class="i">Max</span> <span class="o">=</span> <span class="n">50.0</span>)
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>No value has been returned</code></pre></td></tr></table>
<h2>測定単位を使用する</h2>
<p>もう1つ興味深い機能として、CSV 型プロバイダーは測定単位をサポートしています。
標準SI単位の名前あるいは記号がヘッダに含まれている場合、
生成された型では特定の単位が付加された値が返されるようになります。</p>
<p>このセクションでは以下のような単純なデータが含まれた
<a href="../../data/SmallTest.csv"><code>data/SmallTest.csv</code></a> を使います：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="text">Name,  Distance (metre), Time (s)
First, 50.0,             3.7
</code></pre></td></tr></table>
<p>見ての通り、2列目と3列目にはそれぞれ <code>metre</code> と <code>s</code> という単位があります。
コード側で測定単位を使う場合、
標準単位名を含んだ名前空間をオープンする必要があります。
その後、型プロバイダーのstatic引数に <code>SmallTest.csv</code> を指定します。
なお今回は同じデータを実行時にも使用するため、
同じ引数を再度指定して <code>Load</code> を呼び出すのではなく、
<code>GetSample</code> メソッドを使っていることに注意してください。</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs21', 45)" onmouseover="showTip(event, 'fs21', 45)" class="i">small</span> <span class="o">=</span> <span class="i">CsvProvider</span><span class="o">&lt;</span><span class="s">&quot;../../data/SmallTest.csv&quot;</span><span class="o">&gt;</span><span class="o">.</span><span class="i">GetSample</span>()
</code></pre></td>
</tr>
</table>
<p>先ほどの例と同じく、行データは値 <code>small</code> の <code>Rows</code> プロパティで取得できます。
今回は生成されたプロパティ <code>Distance</code> と <code>Time</code> に単位が付加されています。
以下の単純な計算をみてください：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs22', 46)" onmouseover="showTip(event, 'fs22', 46)" class="i">Microsoft</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 47)" onmouseover="showTip(event, 'fs23', 47)" class="i">FSharp</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs24', 48)" onmouseover="showTip(event, 'fs24', 48)" class="i">Data</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs25', 49)" onmouseover="showTip(event, 'fs25', 49)" class="i">UnitSystems</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 50)" onmouseover="showTip(event, 'fs26', 50)" class="i">SI</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 51)" onmouseover="showTip(event, 'fs27', 51)" class="i">UnitNames</span>

<span class="k">for</span> <span onmouseout="hideTip(event, 'fs10', 52)" onmouseover="showTip(event, 'fs10', 52)" class="i">row</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs21', 53)" onmouseover="showTip(event, 'fs21', 53)" class="i">small</span><span class="o">.</span><span class="i">Rows</span> <span class="k">do</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs28', 54)" onmouseover="showTip(event, 'fs28', 54)" class="i">speed</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 55)" onmouseover="showTip(event, 'fs10', 55)" class="i">row</span><span class="o">.</span><span class="i">Distance</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs10', 56)" onmouseover="showTip(event, 'fs10', 56)" class="i">row</span><span class="o">.</span><span class="i">Time</span>
  <span class="k">if</span> <span onmouseout="hideTip(event, 'fs28', 57)" onmouseover="showTip(event, 'fs28', 57)" class="i">speed</span> <span class="o">&gt;</span> <span class="n">15.0M</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs29', 58)" onmouseover="showTip(event, 'fs29', 58)" class="t">metre</span><span class="o">/</span><span onmouseout="hideTip(event, 'fs30', 59)" onmouseover="showTip(event, 'fs30', 59)" class="t">second</span><span class="o">&gt;</span> <span class="k">then</span> 
    <span onmouseout="hideTip(event, 'fs11', 60)" onmouseover="showTip(event, 'fs11', 60)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s"> (</span><span class="pf">%A</span><span class="s"> m/s)&quot;</span> <span onmouseout="hideTip(event, 'fs10', 61)" onmouseover="showTip(event, 'fs10', 61)" class="i">row</span><span class="o">.</span><span class="i">Name</span> <span onmouseout="hideTip(event, 'fs28', 62)" onmouseover="showTip(event, 'fs28', 62)" class="i">speed</span>
</code></pre></td>
</tr>
</table>
<p><code>Distance</code> と <code>Time</code> の数値的な値はいずれも(かなり小さな値なので)
<code>decimal</code> として推測されています。
したがって <code>speed</code> の型は <code>decimal&lt;meter/second&gt;</code> になります。
そうするとコンパイラは互換性のない値を比較していないかどうか、
つまりたとえばメートル毎秒とキロメートル毎時を比較していたりはしないか
チェックするようになります。</p>
<h2>独自の区切り文字とタブ区切りファイル</h2>
<p>CSV 型プロバイダーはデフォルトではカンマ( <code>,</code> )を区切り文字とします。
しかし場合によっては <code>,</code> ではない区切り文字が
CSVファイルで使われていることがあります。
ヨーロッパの一部の国では <code>,</code> が10進数の区切り文字として使われているため、
CSVの列区切り文字には代わりにセミコロン( <code>;</code> )が使われます。
<code>CsvProvider</code> は省略可能なstatic引数 <code>Separator</code> に
代わりとなる区切り文字を指定できます。
つまりこれを使えばタブ区切り形式のテキストも処理できるわけです。
以下では区切り文字として <code>;</code> を使っています：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs31', 63)" onmouseover="showTip(event, 'fs31', 63)" class="i">airQuality</span> <span class="o">=</span> <span class="i">CsvProvider</span><span class="o">&lt;</span><span class="s">&quot;../../data/AirQuality.csv&quot;</span>, <span class="s">&quot;;&quot;</span><span class="o">&gt;</span><span class="o">.</span><span class="i">GetSample</span>()

<span class="k">for</span> <span onmouseout="hideTip(event, 'fs10', 64)" onmouseover="showTip(event, 'fs10', 64)" class="i">row</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs31', 65)" onmouseover="showTip(event, 'fs31', 65)" class="i">airQuality</span><span class="o">.</span><span class="i">Rows</span> <span class="k">do</span>
  <span class="k">if</span> <span onmouseout="hideTip(event, 'fs10', 66)" onmouseover="showTip(event, 'fs10', 66)" class="i">row</span><span class="o">.</span><span class="i">Month</span> <span class="o">&gt;</span> <span class="n">6</span> <span class="k">then</span> 
    <span onmouseout="hideTip(event, 'fs11', 67)" onmouseover="showTip(event, 'fs11', 67)" class="f">printfn</span> <span class="s">&quot;Temp: </span><span class="pf">%i</span><span class="s"> Ozone: </span><span class="pf">%f</span><span class="s"> &quot;</span> <span onmouseout="hideTip(event, 'fs10', 68)" onmouseover="showTip(event, 'fs10', 68)" class="i">row</span><span class="o">.</span><span class="i">Temp</span> <span onmouseout="hideTip(event, 'fs10', 69)" onmouseover="showTip(event, 'fs10', 69)" class="i">row</span><span class="o">.</span><span class="i">Ozone</span>
</code></pre></td>
</tr>
</table>
<p>空気質のデータセット(<a href="../../data/AirQuality.csv"><code>data/AirQuality.csv</code></a>)は
統計解析向け言語 R の多くのサンプルで使われているものです。
このデータセットの簡単な説明については
<a href="http://stat.ethz.ch/R-manual/R-devel/library/datasets/html/airquality.html">R の言語マニュアル</a>
を参照してください。</p>
<p><code>\t</code> を区切り文字とするようなタブ区切りファイルを処理する場合には
やはり区切り文字を明示的に指定してもよいでしょう。
ですが、URLまたはファイルの末尾にある拡張子が <code>.tsv</code> になっていると
型プロバイダーはデフォルトで <code>\t</code> を区切り文字とするようになります。
以下の例ではstatic引数 <code>IgnoreErrors</code> を <code>true</code> にして、
要素数が異なる行を自動的に無視するようにもしています
(サンプルファイル <a href="../../data/MortalityNY.tsv"><code>data/MortalityNY.csv</code></a> には
末尾に構造化されていないデータが追加されています)：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs32', 70)" onmouseover="showTip(event, 'fs32', 70)" class="i">mortalityNy</span> <span class="o">=</span> <span class="i">CsvProvider</span><span class="o">&lt;</span><span class="s">&quot;../../data/MortalityNY.tsv&quot;</span>, <span class="i">IgnoreErrors</span><span class="o">=</span><span class="k">true</span><span class="o">&gt;</span><span class="o">.</span><span class="i">GetSample</span>()

<span class="c">// 原因名をコードで検索</span>
<span class="c">// (事故で負傷した自転車走者)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs33', 71)" onmouseover="showTip(event, 'fs33', 71)" class="i">cause</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs32', 72)" onmouseover="showTip(event, 'fs32', 72)" class="i">mortalityNy</span><span class="o">.</span><span class="i">Rows</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs6', 73)" onmouseover="showTip(event, 'fs6', 73)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs34', 74)" onmouseover="showTip(event, 'fs34', 74)" class="f">find</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs35', 75)" onmouseover="showTip(event, 'fs35', 75)" class="i">r</span> <span class="k">-&gt;</span> 
  <span onmouseout="hideTip(event, 'fs35', 76)" onmouseover="showTip(event, 'fs35', 76)" class="i">r</span><span class="o">.</span><span class="i">``Cause of death Code``</span> <span class="o">=</span> <span class="s">&quot;V13.4&quot;</span>)

<span class="c">// 負傷した走者数を出力</span>
<span onmouseout="hideTip(event, 'fs11', 77)" onmouseover="showTip(event, 'fs11', 77)" class="f">printfn</span> <span class="s">&quot;原因: </span><span class="pf">%s</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs33', 78)" onmouseover="showTip(event, 'fs33', 78)" class="i">cause</span><span class="o">.</span><span class="i">``Cause of death``</span>
<span class="k">for</span> <span onmouseout="hideTip(event, 'fs35', 79)" onmouseover="showTip(event, 'fs35', 79)" class="i">r</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs32', 80)" onmouseover="showTip(event, 'fs32', 80)" class="i">mortalityNy</span><span class="o">.</span><span class="i">Rows</span> <span class="k">do</span>
  <span class="k">if</span> <span onmouseout="hideTip(event, 'fs35', 81)" onmouseover="showTip(event, 'fs35', 81)" class="i">r</span><span class="o">.</span><span class="i">``Cause of death Code``</span> <span class="o">=</span> <span class="s">&quot;V13.4&quot;</span> <span class="k">then</span> 
    <span onmouseout="hideTip(event, 'fs11', 82)" onmouseover="showTip(event, 'fs11', 82)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s"> (</span><span class="pf">%d</span><span class="s"> 件)&quot;</span> <span onmouseout="hideTip(event, 'fs35', 83)" onmouseover="showTip(event, 'fs35', 83)" class="i">r</span><span class="o">.</span><span class="i">County</span> <span onmouseout="hideTip(event, 'fs35', 84)" onmouseover="showTip(event, 'fs35', 84)" class="i">r</span><span class="o">.</span><span class="i">Count</span>
</code></pre></td>
</tr>
</table>
<p>最後に、 <code>CsvProvider</code> には複数種類の区切り文字を指定することもできます。
これはたとえばファイルが不正で、セミコロンかコロンのどちらかで
行が区切られているような場合に有効です。
具体的には
<code>CsvProvider&lt;"../../data/AirQuality.csv", Separator=";,"&gt;</code>
というようにします。</p>
<h2>値無し</h2>
<p>統計的データセットでは一部の値が無しになっているということがよくあります。
<a href="../../data/AirQuality.csv"><code>data/AirQuality.csv</code></a> ファイルを開くと、
一部のオゾンの観測値が <code>#N/A</code> と記録されていることが確認できます。
このような値はfloatとしてパースされ、F#であれば <code>Double.NaN</code> という値とみなされます。
デフォルトでは <code>#N/A</code> <code>NA</code> <code>:</code> が値無しを表す値と認識されますが、
<code>CsvProvider</code> のstatic引数 <code>MissingValues</code> を指定して
カスタマイズすることもできます。</p>
<p>以下のコードでは <code>Double.NaN</code> になっている値を除いて、
オゾンの観測値の平均を計算しています。
まず各行の <code>Ozone</code> プロパティを取得して値無しを除去した後、
標準の <code>Seq.average</code> 関数を使って平均を計算しています：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs36', 85)" onmouseover="showTip(event, 'fs36', 85)" class="i">mean</span> <span class="o">=</span> 
  <span onmouseout="hideTip(event, 'fs31', 86)" onmouseover="showTip(event, 'fs31', 86)" class="i">airQuality</span><span class="o">.</span><span class="i">Rows</span> 
  <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs6', 87)" onmouseover="showTip(event, 'fs6', 87)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 88)" onmouseover="showTip(event, 'fs37', 88)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs10', 89)" onmouseover="showTip(event, 'fs10', 89)" class="i">row</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs10', 90)" onmouseover="showTip(event, 'fs10', 90)" class="i">row</span><span class="o">.</span><span class="i">Ozone</span>) 
  <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs6', 91)" onmouseover="showTip(event, 'fs6', 91)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs38', 92)" onmouseover="showTip(event, 'fs38', 92)" class="f">filter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs39', 93)" onmouseover="showTip(event, 'fs39', 93)" class="i">elem</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs40', 94)" onmouseover="showTip(event, 'fs40', 94)" class="f">not</span> (<span onmouseout="hideTip(event, 'fs41', 95)" onmouseover="showTip(event, 'fs41', 95)" class="t">Double</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 96)" onmouseover="showTip(event, 'fs42', 96)" class="f">IsNaN</span> <span onmouseout="hideTip(event, 'fs39', 97)" onmouseover="showTip(event, 'fs39', 97)" class="i">elem</span>)) 
  <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs6', 98)" onmouseover="showTip(event, 'fs6', 98)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 99)" onmouseover="showTip(event, 'fs43', 99)" class="f">average</span> 
</code></pre></td>
</tr>
</table>
<p>サンプルとして指定するデータにはどの列にも値無しのデータが含まれていないものの、
実行時にはどこかで値無しが現れる可能性があるという場合には
<code>AssumeMissingValues</code> を <code>true</code> に設定すれば、
<code>CsvProvider</code> がどこかの列には値無しが現れるだろうと想定するようになります。</p>
<h2>列の型を制御する</h2>
<p>デフォルトではCSV 型プロバイダーは最初の1000行を使って型を推測します。
しかし <code>CsvProvider</code> のstatic引数 <code>InferRows</code> を使うと
この動作をカスタマイズできます。
0を指定するとファイル全体が使われるようになります。</p>
<p><code>0</code> <code>1</code> <code>Yes</code> <code>No</code> <code>True</code> <code>False</code> しか含まない列は <code>bool</code> になります。
数値を含む列はそれぞれ精度に応じて <code>int</code> <code>int64</code> <code>decimal</code> <code>float</code> の
いずれかになります。</p>
<p>いずれかの行で値無しになっている場合、CSV 型プロバイダーは
その行を(<code>int</code> および <code>int64</code> に対しては)null許容型、
あるいは(<code>bool</code> <code>DateTime</code> <code>Guid</code> に対しては)オプション型とみなします。
<code>decimal</code> と推測できる列に値無しが含まれる場合、代わりに <code>float</code> とみなされ、
値無しが <code>Double.NaN</code> として表現されます。
<code>string</code> 型はそれ自体が既にnullを許容するため、
デフォルトでは <code>string option</code> と推測されることはありません。
すべての場合においてオプション型になるようにしたい場合には、
static引数 <code>PreferOptionals</code> を <code>true</code> にします。
この設定を行うと、空の文字列や <code>Double.NaN</code> ではなく、
代わりに <code>None</code> が返されるようになります。</p>
<p>他にもたとえば <code>decimal</code> ではなく <code>float</code> として行を扱いたいというような、
別の設定を使いたい場合には、ヘッダ行で列の型を丸括弧で囲んで記述することで
デフォルトの動作を上書きできます。
これは測定単位を指定する方法と同じです。
ヘッダ行による指定方法は <code>AssumeMissingValues</code> や <code>PreferOptionals</code> の動作を上書きします。
指定可能な型は以下の通りです：</p>
<ul>
<li><code>int</code></li>
<li><code>int?</code></li>
<li><code>int option</code></li>
<li><code>int64</code></li>
<li><code>int64?</code></li>
<li><code>int64 option</code></li>
<li><code>bool</code></li>
<li><code>bool?</code></li>
<li><code>bool option</code></li>
<li><code>float</code></li>
<li><code>float?</code></li>
<li><code>float option</code></li>
<li><code>decimal</code></li>
<li><code>decimal?</code></li>
<li><code>decimal option</code></li>
<li><code>date</code></li>
<li><code>date?</code></li>
<li><code>date option</code></li>
<li><code>guid</code></li>
<li><code>guid?</code></li>
<li><code>guid option</code></li>
<li><code>string</code></li>
<li><code>string option</code>.</li>
</ul>
<p>型と測定単位の両方を( <code>float&lt;metre&gt;</code> のようにして)指定することもできます。
たとえば以下の通りです：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="text">Name,  Distance (decimal?&lt;metre&gt;), Time (float)
First, 50,                        3
</code></pre></td></tr></table>
<p>さらに、 <code>CsvProvider</code> のstatic引数 <code>Schema</code> で一部またはすべての型を
指定することもできます。
指定可能な形式は以下の通りです：</p>
<ul>
<li><code>型</code></li>
<li><code>型&lt;測定単位&gt;</code></li>
<li><code>名前 (型)</code></li>
<li><code>名前 (型&lt;測定単位&gt;)</code></li>
</ul>
<p><code>Schema</code> 引数で指定された値はヘッダ行で指定されたものよりも常に優先されます。</p>
<p>ファイルの1行目がヘッダ行ではない場合、static引数 <code>HasHeaders</code> を <code>false</code> に
すると1行目もデータ行とみなされるようになります。
この場合、それぞれの行は <code>Schema</code> 引数で指定されていなければ
<code>Column1</code> <code>Column2</code> という名前になります。
なお <code>Schema</code> 引数で名前だけを上書きしつつ、
型プロバイダーに列の型を推測させることもできます。
たとえば以下のようにします：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs44', 100)" onmouseover="showTip(event, 'fs44', 100)" class="i">csv</span> <span class="o">=</span> <span class="i">CsvProvider</span><span class="o">&lt;</span><span class="s">&quot;1,2,3&quot;</span>, <span class="i">HasHeaders</span> <span class="o">=</span> <span class="k">false</span>, <span class="i">Schema</span> <span class="o">=</span> <span class="s">&quot;Duration (float&lt;second&gt;),foo,float option&quot;</span><span class="o">&gt;</span><span class="o">.</span><span class="i">GetSample</span>()
<span class="k">for</span> <span onmouseout="hideTip(event, 'fs10', 101)" onmouseover="showTip(event, 'fs10', 101)" class="i">row</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs44', 102)" onmouseover="showTip(event, 'fs44', 102)" class="i">csv</span><span class="o">.</span><span class="i">Rows</span> <span class="k">do</span>
  <span onmouseout="hideTip(event, 'fs11', 103)" onmouseover="showTip(event, 'fs11', 103)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%f</span><span class="s"> </span><span class="pf">%d</span><span class="s"> </span><span class="pf">%f</span><span class="s">&quot;</span> (<span onmouseout="hideTip(event, 'fs10', 104)" onmouseover="showTip(event, 'fs10', 104)" class="i">row</span><span class="o">.</span><span class="i">Duration</span><span class="o">/</span><span class="n">1.0</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs30', 105)" onmouseover="showTip(event, 'fs30', 105)" class="t">second</span><span class="o">&gt;</span>) <span onmouseout="hideTip(event, 'fs10', 106)" onmouseover="showTip(event, 'fs10', 106)" class="i">row</span><span class="o">.</span><span class="i">Foo</span> (<span onmouseout="hideTip(event, 'fs45', 107)" onmouseover="showTip(event, 'fs45', 107)" class="f">defaultArg</span> <span onmouseout="hideTip(event, 'fs10', 108)" onmouseover="showTip(event, 'fs10', 108)" class="i">row</span><span class="o">.</span><span class="i">Column3</span> <span class="n">1.0</span>)
</code></pre></td>
</tr>
</table>
<p>必ずしもすべての列を上書きしなければいけないわけではなく、
一部をデフォルトのままにしておくこともできます。
たとえばKaggleから取得したタイタニックの乗船者データ
(<a href="../../data/Titanic.csv"><code>data/Titanic.csv</code></a>)
を対象にしている時に、3列目( <code>PClass</code> 列)を <code>Passenger Class</code> 、
6列目( <code>Fare</code> 列)を <code>decimal</code> ではなく <code>float</code> にしたい場合、
これらだけを定義しておいて、その他の行が空になっているようなスキーマを
指定します(末尾で連続するカンマは省略できます)。</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs46', 109)" onmouseover="showTip(event, 'fs46', 109)" class="i">titanic1</span> <span class="o">=</span> <span class="i">CsvProvider</span><span class="o">&lt;</span><span class="s">&quot;../../data/Titanic.csv&quot;</span>, <span class="i">Schema</span><span class="o">=</span><span class="s">&quot;,,Passenger Class,,,float&quot;</span><span class="o">&gt;</span><span class="o">.</span><span class="i">GetSample</span>()
<span class="k">for</span> <span onmouseout="hideTip(event, 'fs10', 110)" onmouseover="showTip(event, 'fs10', 110)" class="i">row</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs46', 111)" onmouseover="showTip(event, 'fs46', 111)" class="i">titanic1</span><span class="o">.</span><span class="i">Rows</span> <span class="k">do</span>
  <span onmouseout="hideTip(event, 'fs11', 112)" onmouseover="showTip(event, 'fs11', 112)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s"> Class = </span><span class="pf">%d</span><span class="s"> Fare = </span><span class="pf">%g</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs10', 113)" onmouseover="showTip(event, 'fs10', 113)" class="i">row</span><span class="o">.</span><span class="i">Name</span> <span onmouseout="hideTip(event, 'fs10', 114)" onmouseover="showTip(event, 'fs10', 114)" class="i">row</span><span class="o">.</span><span class="i">``Passenger Class``</span> <span onmouseout="hideTip(event, 'fs10', 115)" onmouseover="showTip(event, 'fs10', 115)" class="i">row</span><span class="o">.</span><span class="i">Fare</span>
</code></pre></td>
</tr>
</table>
<p>あるいは位置で指定する代わりに列の名前を使って上書きすることもできます：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs47', 116)" onmouseover="showTip(event, 'fs47', 116)" class="i">titanic2</span> <span class="o">=</span> <span class="i">CsvProvider</span><span class="o">&lt;</span><span class="s">&quot;../../data/Titanic.csv&quot;</span>, <span class="i">Schema</span><span class="o">=</span><span class="s">&quot;Fare=float,PClass-&gt;Passenger Class&quot;</span><span class="o">&gt;</span><span class="o">.</span><span class="i">GetSample</span>()
<span class="k">for</span> <span onmouseout="hideTip(event, 'fs10', 117)" onmouseover="showTip(event, 'fs10', 117)" class="i">row</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs47', 118)" onmouseover="showTip(event, 'fs47', 118)" class="i">titanic2</span><span class="o">.</span><span class="i">Rows</span> <span class="k">do</span>
  <span onmouseout="hideTip(event, 'fs11', 119)" onmouseover="showTip(event, 'fs11', 119)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s"> Class = </span><span class="pf">%d</span><span class="s"> Fare = </span><span class="pf">%g</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs10', 120)" onmouseover="showTip(event, 'fs10', 120)" class="i">row</span><span class="o">.</span><span class="i">Name</span> <span onmouseout="hideTip(event, 'fs10', 121)" onmouseover="showTip(event, 'fs10', 121)" class="i">row</span><span class="o">.</span><span class="i">``Passenger Class``</span> <span onmouseout="hideTip(event, 'fs10', 122)" onmouseover="showTip(event, 'fs10', 122)" class="i">row</span><span class="o">.</span><span class="i">Fare</span>
</code></pre></td>
</tr>
</table>
<p>これら2つのシンタックスを組み合わせて
<code>Schema="int64,DidSurvive,PClass-&gt;Passenger Class=string"</code>
とすることもできます。</p>
<h2>CSVファイルの変形</h2>
<p><code>CsvProvider</code> はファイルの読み取りだけでなく、データの変形もサポートしています。
<code>Filter</code> <code>Take</code> <code>TakeWhile</code> <code>Skip</code> <code>SkipWhile</code> <code>Truncate</code> という操作が可能です。
これらはいずれもスキーマを維持するようになっているため、
変形後は <code>Save</code> メソッドのいずれかのオーバーロードを使って結果を保存できます。
結果をCSV形式で保存したくない場合、あるいはデータの形式を変更したい場合には、
<code>Rows</code> プロパティで取得できる行のシーケンスに対して直接
<code>Seq</code> モジュールの機能を使うこともできます。</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// 値無しのデータを含まない先頭10行を新しいCSVファイルに保存する</span>
<span onmouseout="hideTip(event, 'fs31', 123)" onmouseover="showTip(event, 'fs31', 123)" class="i">airQuality</span><span class="o">.</span><span class="i">Filter</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs10', 124)" onmouseover="showTip(event, 'fs10', 124)" class="i">row</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs40', 125)" onmouseover="showTip(event, 'fs40', 125)" class="i">not</span> (<span onmouseout="hideTip(event, 'fs41', 126)" onmouseover="showTip(event, 'fs41', 126)" class="i">Double</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 127)" onmouseover="showTip(event, 'fs42', 127)" class="i">IsNaN</span> <span onmouseout="hideTip(event, 'fs10', 128)" onmouseover="showTip(event, 'fs10', 128)" class="i">row</span><span class="o">.</span><span class="i">Ozone</span>) <span class="o">&amp;&amp;</span> 
                             <span onmouseout="hideTip(event, 'fs40', 129)" onmouseover="showTip(event, 'fs40', 129)" class="i">not</span> (<span onmouseout="hideTip(event, 'fs41', 130)" onmouseover="showTip(event, 'fs41', 130)" class="i">Double</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 131)" onmouseover="showTip(event, 'fs42', 131)" class="i">IsNaN</span> <span onmouseout="hideTip(event, 'fs10', 132)" onmouseover="showTip(event, 'fs10', 132)" class="i">row</span><span class="o">.</span><span class="i">``Solar.R``</span>))
          <span class="o">.</span><span class="i">Truncate</span>(<span class="n">10</span>)
          <span class="o">.</span><span class="i">SaveToString</span>()
</code></pre></td>
</tr>
</table>
<h2>ビッグデータの処理</h2>
<p>デフォルトでは行がキャッシュされるため、 <code>Rows</code> プロパティを複数回走査しても
特に問題はありません。
しかし1回しか走査しないのであれば、 <code>CsvProvider</code> のstatic引数
<code>CacheRows</code> を <code>false</code> にすればキャッシュを無効化できます。
行数が非常に多い場合、キャッシュを無効化しなければ
メモリを消費し尽くしてしまうことになるでしょう。
<code>Cache</code> メソッドを使えば任意のタイミングでデータをキャッシュできますが、
データセットを小さなサイズに変形した後に限定すべきです：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs48', 133)" onmouseover="showTip(event, 'fs48', 133)" class="i">stocks</span> <span class="o">=</span> <span class="i">CsvProvider</span><span class="o">&lt;</span><span class="s">&quot;http://www.google.com/finance/historical?q=MSFT&amp;output=csv&quot;</span>, <span class="i">CacheRows</span><span class="o">=</span><span class="k">false</span><span class="o">&gt;</span><span class="o">.</span><span class="i">GetSample</span>()
<span onmouseout="hideTip(event, 'fs48', 134)" onmouseover="showTip(event, 'fs48', 134)" class="i">stocks</span><span class="o">.</span><span class="i">Take</span>(<span class="n">10</span>)<span class="o">.</span><span class="i">Cache</span>()
</code></pre></td>
</tr>
</table>
<h2>関連する記事</h2>
<ul>
<li>
<a href="CsvFile.html">F# Data: CSV パーサーおよびリーダー</a> -
CSVドキュメントを動的に処理するための詳しい説明があります。
</li>
<li><a href="../../reference/fsharp-data-csvprovider.html">API リファレンス: CsvProvider 型プロバイダー</a></li>
</ul>

<div class="tip" id="fs1">Multiple items<br />namespace FSharp<br /><br />--------------------<br />namespace Microsoft.FSharp</div>
<div class="tip" id="fs2">Multiple items<br />namespace FSharp.Data<br /><br />--------------------<br />namespace Microsoft.FSharp.Data</div>
<div class="tip" id="fs3">type Stocks = obj<br /><br />Full name: CsvProvider.Stocks</div>
<div class="tip" id="fs4">val msft : obj<br /><br />Full name: CsvProvider.msft</div>
<div class="tip" id="fs5">val firstRow : obj<br /><br />Full name: CsvProvider.firstRow</div>
<div class="tip" id="fs6">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs7">val head : source:seq&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Collections.Seq.head</div>
<div class="tip" id="fs8">val lastDate : obj<br /><br />Full name: CsvProvider.lastDate</div>
<div class="tip" id="fs9">val lastOpen : obj<br /><br />Full name: CsvProvider.lastOpen</div>
<div class="tip" id="fs10">val row : obj</div>
<div class="tip" id="fs11">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs12">namespace System</div>
<div class="tip" id="fs13">namespace FSharp.Charting</div>
<div class="tip" id="fs14">type Chart =<br />&#160;&#160;static member Area : data:seq&lt;#value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; GenericChart<br />&#160;&#160;static member Area : data:seq&lt;#key * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; GenericChart<br />&#160;&#160;static member Bar : data:seq&lt;#value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; GenericChart<br />&#160;&#160;static member Bar : data:seq&lt;#key * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; GenericChart<br />&#160;&#160;static member BoxPlotFromData : data:seq&lt;#key * #seq&lt;&#39;a2&gt;&gt; * ?Name:string * ?Title:string * ?Color:Color * ?XTitle:string * ?YTitle:string * ?Percentile:int * ?ShowAverage:bool * ?ShowMedian:bool * ?ShowUnusualValues:bool * ?WhiskerPercentile:int -&gt; GenericChart (requires &#39;a2 :&gt; value)<br />&#160;&#160;static member BoxPlotFromStatistics : data:seq&lt;#key * #value * #value * #value * #value * #value * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string * ?Percentile:int * ?ShowAverage:bool * ?ShowMedian:bool * ?ShowUnusualValues:bool * ?WhiskerPercentile:int -&gt; GenericChart<br />&#160;&#160;static member Bubble : data:seq&lt;#value * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string * ?BubbleMaxSize:int * ?BubbleMinSize:int * ?BubbleScaleMax:float * ?BubbleScaleMin:float * ?UseSizeForLabel:bool -&gt; GenericChart<br />&#160;&#160;static member Bubble : data:seq&lt;#key * #value * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string * ?BubbleMaxSize:int * ?BubbleMinSize:int * ?BubbleScaleMax:float * ?BubbleScaleMin:float * ?UseSizeForLabel:bool -&gt; GenericChart<br />&#160;&#160;static member Candlestick : data:seq&lt;#value * #value * #value * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; CandlestickChart<br />&#160;&#160;static member Candlestick : data:seq&lt;#key * #value * #value * #value * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Color * ?XTitle:string * ?YTitle:string -&gt; CandlestickChart<br />&#160;&#160;...<br /><br />Full name: FSharp.Charting.Chart</div>
<div class="tip" id="fs15">static member Chart.FastLine : data:seq&lt;#value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Drawing.Color * ?XTitle:string * ?YTitle:string -&gt; ChartTypes.GenericChart<br />static member Chart.FastLine : data:seq&lt;#key * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Drawing.Color * ?XTitle:string * ?YTitle:string -&gt; ChartTypes.GenericChart</div>
<div class="tip" id="fs16">val recent : (obj * obj * obj * obj * obj) list<br /><br />Full name: CsvProvider.recent</div>
<div class="tip" id="fs17">Multiple items<br />type DateTime =<br />&#160;&#160;struct<br />&#160;&#160;&#160;&#160;new : ticks:int64 -&gt; DateTime + 10 overloads<br />&#160;&#160;&#160;&#160;member Add : value:TimeSpan -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddDays : value:float -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddHours : value:float -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddMilliseconds : value:float -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddMinutes : value:float -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddMonths : months:int -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddSeconds : value:float -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddTicks : value:int64 -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddYears : value:int -&gt; DateTime<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: System.DateTime<br /><br />--------------------<br />DateTime()<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(ticks: int64) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(ticks: int64, kind: DateTimeKind) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(year: int, month: int, day: int) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(year: int, month: int, day: int, calendar: Globalization.Calendar) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(year: int, month: int, day: int, hour: int, minute: int, second: int) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(year: int, month: int, day: int, hour: int, minute: int, second: int, kind: DateTimeKind) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(year: int, month: int, day: int, hour: int, minute: int, second: int, calendar: Globalization.Calendar) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(year: int, month: int, day: int, hour: int, minute: int, second: int, millisecond: int) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(year: int, month: int, day: int, hour: int, minute: int, second: int, millisecond: int, kind: DateTimeKind) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em></div>
<div class="tip" id="fs18">property DateTime.Now: DateTime</div>
<div class="tip" id="fs19">DateTime.AddDays(value: float) : DateTime</div>
<div class="tip" id="fs20">static member Chart.Candlestick : data:seq&lt;#value * #value * #value * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Drawing.Color * ?XTitle:string * ?YTitle:string -&gt; ChartTypes.CandlestickChart<br />static member Chart.Candlestick : data:seq&lt;#key * #value * #value * #value * #value&gt; * ?Name:string * ?Title:string * ?Labels:#seq&lt;string&gt; * ?Color:Drawing.Color * ?XTitle:string * ?YTitle:string -&gt; ChartTypes.CandlestickChart</div>
<div class="tip" id="fs21">val small : obj<br /><br />Full name: CsvProvider.small</div>
<div class="tip" id="fs22">namespace Microsoft</div>
<div class="tip" id="fs23">namespace Microsoft.FSharp</div>
<div class="tip" id="fs24">namespace Microsoft.FSharp.Data</div>
<div class="tip" id="fs25">namespace Microsoft.FSharp.Data.UnitSystems</div>
<div class="tip" id="fs26">namespace Microsoft.FSharp.Data.UnitSystems.SI</div>
<div class="tip" id="fs27">namespace Microsoft.FSharp.Data.UnitSystems.SI.UnitNames</div>
<div class="tip" id="fs28">val speed : decimal&lt;metre/second&gt;</div>
<div class="tip" id="fs29">[&lt;Measure&gt;]<br />type metre<br /><br />Full name: Microsoft.FSharp.Data.UnitSystems.SI.UnitNames.metre</div>
<div class="tip" id="fs30">[&lt;Measure&gt;]<br />type second<br /><br />Full name: Microsoft.FSharp.Data.UnitSystems.SI.UnitNames.second</div>
<div class="tip" id="fs31">val airQuality : obj<br /><br />Full name: CsvProvider.airQuality</div>
<div class="tip" id="fs32">val mortalityNy : obj<br /><br />Full name: CsvProvider.mortalityNy</div>
<div class="tip" id="fs33">val cause : obj<br /><br />Full name: CsvProvider.cause</div>
<div class="tip" id="fs34">val find : predicate:(&#39;T -&gt; bool) -&gt; source:seq&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Collections.Seq.find</div>
<div class="tip" id="fs35">val r : obj</div>
<div class="tip" id="fs36">val mean : float<br /><br />Full name: CsvProvider.mean</div>
<div class="tip" id="fs37">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.map</div>
<div class="tip" id="fs38">val filter : predicate:(&#39;T -&gt; bool) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.filter</div>
<div class="tip" id="fs39">val elem : float</div>
<div class="tip" id="fs40">val not : value:bool -&gt; bool<br /><br />Full name: Microsoft.FSharp.Core.Operators.not</div>
<div class="tip" id="fs41">type Double =<br />&#160;&#160;struct<br />&#160;&#160;&#160;&#160;member CompareTo : value:obj -&gt; int + 1 overload<br />&#160;&#160;&#160;&#160;member Equals : obj:obj -&gt; bool + 1 overload<br />&#160;&#160;&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;&#160;&#160;member GetTypeCode : unit -&gt; TypeCode<br />&#160;&#160;&#160;&#160;member ToString : unit -&gt; string + 3 overloads<br />&#160;&#160;&#160;&#160;static val MinValue : float<br />&#160;&#160;&#160;&#160;static val MaxValue : float<br />&#160;&#160;&#160;&#160;static val Epsilon : float<br />&#160;&#160;&#160;&#160;static val NegativeInfinity : float<br />&#160;&#160;&#160;&#160;static val PositiveInfinity : float<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: System.Double</div>
<div class="tip" id="fs42">Double.IsNaN(d: float) : bool</div>
<div class="tip" id="fs43">val average : source:seq&lt;&#39;T&gt; -&gt; &#39;T (requires member ( + ) and member DivideByInt and member get_Zero)<br /><br />Full name: Microsoft.FSharp.Collections.Seq.average</div>
<div class="tip" id="fs44">val csv : obj<br /><br />Full name: CsvProvider.csv</div>
<div class="tip" id="fs45">val defaultArg : arg:&#39;T option -&gt; defaultValue:&#39;T -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.defaultArg</div>
<div class="tip" id="fs46">val titanic1 : obj<br /><br />Full name: CsvProvider.titanic1</div>
<div class="tip" id="fs47">val titanic2 : obj<br /><br />Full name: CsvProvider.titanic2</div>
<div class="tip" id="fs48">val stocks : obj<br /><br />Full name: CsvProvider.stocks</div>

        </div>
        <div class="span3">
          <a href="/FSharp.Data/ja/index.html">
            <img src="/FSharp.Data/images/logo.png" style="width:140px;height:140px;margin:10px 0px 0px 35px;border-style:none;" />
          </a>

          <ul class="nav nav-list" id="menu">
            <li class="nav-header">
              <a href="/FSharp.Data/ja/index.html" class="nflag"><img src="/FSharp.Data/images/ja.png" /></a>
              <a href="/FSharp.Data/index.html" class="nflag nflag2"><img src="/FSharp.Data/images/en.png" /></a>
              F# Data
            </li>
            <li class="divider"></li>
            <li><a href="https://nuget.org/packages/FSharp.Data">NuGet経由でライブラリを取得</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data">GitHub上のソースコード</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/LICENSE.md">License (Apache 2.0)</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/RELEASE_NOTES.md">リリースノート</a></li>
            <li><span>
                <a href="/FSharp.Data/ja/contributing.html">F# Dataに貢献する</a>
                (<a href="http://github.com/fsharp/FSharp.Data/blob/master/CONTRIBUTING.md">En</a>)
                </span></li>
            
            <li class="nav-header">F# Data ライブラリ</li>
            <li><span>
                <a href="/FSharp.Data/ja/index.html">はじめに</a>
                (<a href="/FSharp.Data/index.html">En</a>)
                </span></li>
            <li class="divider"></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/JsonProvider.html">JSON 型プロバイダー</a>
                (<a href="/FSharp.Data/library/JsonProvider.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/XmlProvider.html">XML 型プロバイダー</a>
                (<a href="/FSharp.Data/library/XmlProvider.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/CsvProvider.html">CSV 型プロバイダー</a>
                (<a href="/FSharp.Data/library/CsvProvider.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/WorldBank.html">WorldBank プロバイダー</a>
                (<a href="/FSharp.Data/library/WorldBank.html">En</a>)
                </span></li>
            <li class="divider"></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/Http.html">HTTP ユーティリティ</a>
                (<a href="/FSharp.Data/library/Http.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/CsvFile.html">CSV パーサーおよびリーダー</a>
                (<a href="/FSharp.Data/library/CsvFile.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/JsonValue.html">JSON パーサーおよびリーダー</a>
                (<a href="/FSharp.Data/library/JsonValue.html">En</a>)
                </span></li>

            <li class="nav-header">チュートリアル</li>
            <li><span>
                <a href="/FSharp.Data/ja/tutorials/JsonToXml.html">JSONとXMLの相互変換</a>
                (<a href="/FSharp.Data/tutorials/JsonToXml.html">En</a>)
                </span></li>

            <li><span>
                <a href="/FSharp.Data/ja/tutorials/JsonAnonymizer.html">JSONの匿名化</a>
                (<a href="/FSharp.Data/tutorials/JsonAnonymizer.html">En</a>)
                </span></li>

            <li class="nav-header">リファレンス</li>
            <li><span>
                <a href="/FSharp.Data/reference/index.html">API リファレンス (En)</a>
                </span></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/fsharp/FSharp.Data"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
  </html>