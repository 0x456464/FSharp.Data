<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>F# Data: XML 型プロバイダー
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The F# Data library implements type providers for working with structured file formats (CSV, HTML, JSON and XML) and for accessing the WorldBank data. It also includes helpers for parsing CSV, HTML and JSON files, and for sending HTTP requests.">
    <meta name="author" content="Tomas Petricek; Gustavo Guerra">

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/style.css" />
    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/fsdata.css" />
    <script type="text/javascript" src="/FSharp.Data/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="https://bluemountaincapital.github.io/Deedle"><img height="16" width="16" src="/images/Deedle.png" /> Deedle</a></li>
          <li><a href="https://bluemountaincapital.github.io/FSharpRProvider"><img height=" 16" width="16" src="/images/FSharpRProvider.png" /> R Provider</a></li>
          <li><a href="https://fsharp.github.io/FSharp.Charting/"><img height="16" width="16" src="/images/FSharp.Charting.png" /> F# Charting</a></li>
          <li><a href="https://fsprojects.github.io/FSharp.Data.Toolbox"><img height="16" width="16" src="/images/FSharp.Data.Toolbox.png" /> F# Data Toolbox</a></li>
        </ul>
        <h3 class="muted"><a href="/FSharp.Data/ja/index.html">F# Data</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1>F# Data: XML 型プロバイダー</h1>
<p>このドキュメントではXML型プロバイダーを使用して、静的に型付けされた
方法でXMLドキュメントにアクセスする方法について説明します。
まず、XMLドキュメントの構造が推測される方法について説明した後に、
XML型プロバイダーを使用してRSSフィードを解析するデモを紹介します。</p>
<p>ML型プロバイダーを使用すると、静的に型付けされた方法でXMLドキュメントに
アクセスできます。
このプロバイダーはサンプルとなるドキュメントを入力として受け取ります
(あるいはサンプルとして使用されるような複数の子ノードを持った
ルートXMLノードを含むドキュメントを受け取ります)。
そして生成された型を使用すると、サンプルドキュメントと同じ構造のファイルを
読み取ることができるようになります。
ファイルの構造がサンプルと異なる場合には実行時エラーが発生します
(ただし存在しない要素にアクセスしようとした場合に限られます)。</p>
<h2>プロバイダーの基本</h2>
<p>型プロバイダーは <code>FSharp.Data.dll</code> アセンブリ内にあります。
このアセンブリが <code>../../../../bin</code> ディレクトリにあると仮定すると、
F# Interactive内で読み込むためには以下のようにします
(なおこの型プロバイダーは内部で <code>XDocument</code> を使用しているため、
<code>System.Xml.Linq</code> への参照も必要になる点に注意してください)：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;../../../../bin/FSharp.Data.dll&quot;</span>
<span class="prep">#r</span> <span class="s">&quot;System.Xml.Linq.dll&quot;</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">FSharp</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">Data</span>
</code></pre></td>
</tr>
</table>
<h3>サンプルからの型の推論</h3>
<p><code>XmlProvider&lt;...&gt;</code> には <code>string</code> 型の静的パラメータを1つ指定します。
このパラメータには <strong>サンプルとなるXML文字列</strong> または
<strong>サンプルファイル</strong> のいずれかを指定します
(カレントディレクトリからの相対パスか、 <strong>http</strong> または <strong>https</strong> 経由で
アクセス可能なファイル名を指定します)。
パラメータの値があいまいで認識できないようなケースはほとんど無いでしょう。</p>
<p>以下のサンプルではルートノードに2つの属性を持ったXMLドキュメントを
読み取ることができるような型を生成しています：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="t">Author</span> <span class="o">=</span> <span class="i">XmlProvider</span><span class="o">&lt;</span><span class="s">&quot;&quot;&quot;&lt;author name=&quot;Paul Feyerabend&quot; born=&quot;1924&quot; /&gt;&quot;&quot;&quot;</span><span class="o">&gt;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">sample</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 5)" onmouseover="showTip(event, 'fs3', 5)" class="i">Author</span><span class="o">.</span><span class="i">Parse</span>(<span class="s">&quot;&quot;&quot;&lt;author name=&quot;Karl Popper&quot; born=&quot;1902&quot; /&gt;&quot;&quot;&quot;</span>)

<span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s"> (</span><span class="pf">%d</span><span class="s">)&quot;</span> <span onmouseout="hideTip(event, 'fs4', 7)" onmouseover="showTip(event, 'fs4', 7)" class="i">sample</span><span class="o">.</span><span class="i">Name</span> <span onmouseout="hideTip(event, 'fs4', 8)" onmouseover="showTip(event, 'fs4', 8)" class="i">sample</span><span class="o">.</span><span class="i">Born</span>
</code></pre></td>
</tr>
</table>
<p>型プロバイダーによって生成された型 <code>Author</code> には、XMLドキュメントの
ルート要素にある2つの属性と同じ名前のプロパティがあります。
プロパティの型はサンプルとして指定したドキュメントの値から推測されます。
今回の場合、 <code>Name</code> プロパティは <code>string</code> 型で
<code>Born</code> プロパティは <code>int</code> 型です。</p>
<p>XMLは非常に柔軟な形式なので、同じドキュメントを異なる形式で表現できます。
具体的には属性を使用する代わりに、値を直接含むようなネストされたノードとして
表現できます( <code>&lt;author&gt;</code> 以下に <code>&lt;name&gt;</code> および <code>&lt;born&gt;</code> をネストさせます)</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs6', 9)" onmouseover="showTip(event, 'fs6', 9)" class="t">AuthorAlt</span> <span class="o">=</span> <span class="i">XmlProvider</span><span class="o">&lt;</span><span class="s">&quot;&lt;author&gt;&lt;name&gt;Karl Popper&lt;/name&gt;&lt;born&gt;1902&lt;/born&gt;&lt;/author&gt;&quot;</span><span class="o">&gt;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs7', 10)" onmouseover="showTip(event, 'fs7', 10)" class="i">doc</span> <span class="o">=</span> <span class="s">&quot;&lt;author&gt;&lt;name&gt;Paul Feyerabend&lt;/name&gt;&lt;born&gt;1924&lt;/born&gt;&lt;/author&gt;&quot;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="i">sampleAlt</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs6', 12)" onmouseover="showTip(event, 'fs6', 12)" class="i">AuthorAlt</span><span class="o">.</span><span class="i">Parse</span>(<span onmouseout="hideTip(event, 'fs7', 13)" onmouseover="showTip(event, 'fs7', 13)" class="i">doc</span>)

<span onmouseout="hideTip(event, 'fs5', 14)" onmouseover="showTip(event, 'fs5', 14)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s"> (</span><span class="pf">%d</span><span class="s">)&quot;</span> <span onmouseout="hideTip(event, 'fs8', 15)" onmouseover="showTip(event, 'fs8', 15)" class="i">sampleAlt</span><span class="o">.</span><span class="i">Name</span> <span onmouseout="hideTip(event, 'fs8', 16)" onmouseover="showTip(event, 'fs8', 16)" class="i">sampleAlt</span><span class="o">.</span><span class="i">Born</span>
</code></pre></td>
</tr>
</table>
<p>生成された型を使用すると、同じ形式のドキュメントを読み取る場合には完全に同じAPIで
アクセスできるようになります（ただし1番目の形式を使用するサンプルを <code>AuthorAlt</code>
で解析することはできません。両者は単にpublic APIの形式が同じだけであって、
型の実装としてはそれぞれ別のものだからです）。</p>
<p>この型プロバイダーはノードにプリミティブな値だけが含まれていて、子ノードも属性も
持たないような場合に限って、ノードを単純に型付けされたプロパティへと変換します。</p>
<h3>さらに複雑な構造を持つドキュメントに対する型</h3>
<p>もう少し興味深い構造を持った例をいくつか見ていくことにしましょう。
まず、ノードが同じ値を持つものの、属性の値が異なる場合にはどうなるでしょうか？</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs9', 17)" onmouseover="showTip(event, 'fs9', 17)" class="t">Detailed</span> <span class="o">=</span> <span class="i">XmlProvider</span><span class="o">&lt;</span><span class="s">&quot;&quot;&quot;&lt;author&gt;&lt;name full=&quot;true&quot;&gt;Karl Popper&lt;/name&gt;&lt;/author&gt;&quot;&quot;&quot;</span><span class="o">&gt;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 18)" onmouseover="showTip(event, 'fs10', 18)" class="i">info</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs9', 19)" onmouseover="showTip(event, 'fs9', 19)" class="i">Detailed</span><span class="o">.</span><span class="i">Parse</span>(<span class="s">&quot;&quot;&quot;&lt;author&gt;&lt;name full=&quot;false&quot;&gt;Thomas Kuhn&lt;/name&gt;&lt;/author&gt;&quot;&quot;&quot;</span>)

<span onmouseout="hideTip(event, 'fs5', 20)" onmouseover="showTip(event, 'fs5', 20)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s"> (full=</span><span class="pf">%b</span><span class="s">)&quot;</span> <span onmouseout="hideTip(event, 'fs10', 21)" onmouseover="showTip(event, 'fs10', 21)" class="i">info</span><span class="o">.</span><span class="i">Name</span><span class="o">.</span><span class="i">Value</span> <span onmouseout="hideTip(event, 'fs10', 22)" onmouseover="showTip(event, 'fs10', 22)" class="i">info</span><span class="o">.</span><span class="i">Name</span><span class="o">.</span><span class="i">Full</span>
</code></pre></td>
</tr>
</table>
<p>ノードが( <code>string</code> のような)単純型として表現できない場合、
この型プロバイダーは複数のプロパティを持つような型を新しく作成します。
今回の場合、(属性の名前を元にして) <code>Full</code> というbool型のプロパティが生成されます。
次に要素のコンテンツを返すような、<code>Value</code> という(特別な)名前のプロパティが
追加されます。</p>
<h3>単純な要素を複数持つドキュメントに対する型</h3>
<p>もう1つ興味深い例として、プリミティブ値しか持たないような複数のノードが存在する
場合を考えてみましょう。
以下の例ではルートノード以下に複数の <code>&lt;value&gt;</code> ノードがあるドキュメントを
サンプルとして指定しています( <code>Parse</code> メソッドにパラメータを指定しなかった場合、
スキーマ用に指定したものと同じテキストが実行時の値に反映されます)。</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs11', 23)" onmouseover="showTip(event, 'fs11', 23)" class="t">Test</span> <span class="o">=</span> <span class="i">XmlProvider</span><span class="o">&lt;</span><span class="s">&quot;&lt;root&gt;&lt;value&gt;1&lt;/value&gt;&lt;value&gt;3&lt;/value&gt;&lt;/root&gt;&quot;</span><span class="o">&gt;</span>

<span onmouseout="hideTip(event, 'fs11', 24)" onmouseover="showTip(event, 'fs11', 24)" class="i">Test</span><span class="o">.</span><span class="i">GetSample</span>()<span class="o">.</span><span class="i">Values</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 25)" onmouseover="showTip(event, 'fs12', 25)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 26)" onmouseover="showTip(event, 'fs13', 26)" class="f">iter</span> (<span onmouseout="hideTip(event, 'fs5', 27)" onmouseover="showTip(event, 'fs5', 27)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%d</span><span class="s">&quot;</span>)
</code></pre></td>
</tr>
</table>
<p>型パラメータは複数の値を配列として返すような <code>Values</code> メソッドを生成します。
<code>&lt;value&gt;</code> ノードは任意個の属性や子ノードを持つわけではないため、
それぞれ <code>int</code> 値となり、 <code>Values</code> メソッドも単に <code>int[]</code> を返すようになります！</p>
<h2>哲学者たちをもてなす</h2>
<p>このセクションでは特定の話題に関する著者のリストを含んだ、単純なドキュメントを
型プロバイダーで処理する方法についてのデモを紹介します。
サンプルとなるドキュメント <a href="../../data/Writers.xml"><code>data/Writers.xml</code></a> は
以下のようになっています：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="xml"><span class="k">&lt;</span><span class="i">authors</span> <span class="o">topic</span><span class="k">="Philosophy of Science"</span><span class="k">&gt;</span>
  <span class="k">&lt;</span><span class="i">author</span> <span class="o">name</span><span class="k">="Paul Feyerabend"</span> <span class="o">born</span><span class="k">="1924"</span> <span class="k">/&gt;</span>
  <span class="k">&lt;</span><span class="i">author</span> <span class="o">name</span><span class="k">="Thomas Kuhn"</span> <span class="k">/&gt;</span>
<span class="k">&lt;/</span><span class="i">authors</span><span class="k">&gt;</span> 
</code></pre></td></tr></table>
<p>実行時には型プロバイダーから生成された型を使用して、以下のような文字列を
解析します(構造としてはサンプルのドキュメントと同じですが、
<code>author</code> ノードに <code>died</code> 属性が含まれているという違いがあります)：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs14', 28)" onmouseover="showTip(event, 'fs14', 28)" class="i">authors</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">  &lt;authors topic=&quot;Philosophy of Mathematics&quot;&gt;</span>
<span class="s">    &lt;author name=&quot;Bertrand Russell&quot; /&gt;</span>
<span class="s">    &lt;author name=&quot;Ludwig Wittgenstein&quot; born=&quot;1889&quot; /&gt;</span>
<span class="s">    &lt;author name=&quot;Alfred North Whitehead&quot; died=&quot;1947&quot; /&gt;</span>
<span class="s">  &lt;/authors&gt; &quot;&quot;&quot;</span>
</code></pre></td>
</tr>
</table>
<p><code>XmlProvider</code> の初期化時にはファイル名またはWebのURLを指定できます。
<code>Load</code> や <code>AsyncLoad</code> メソッドを使用すると、
ファイルあるいはWeb上のリソースを読み取ることができます。
<code>Parse</code> メソッドの場合はデータとして文字列を指定できるため、以下のようにすると
データ内の情報を表示することができます：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs15', 29)" onmouseover="showTip(event, 'fs15', 29)" class="t">Authors</span> <span class="o">=</span> <span class="i">XmlProvider</span><span class="o">&lt;</span><span class="s">&quot;../../data/Writers.xml&quot;</span><span class="o">&gt;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs16', 30)" onmouseover="showTip(event, 'fs16', 30)" class="i">topic</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs15', 31)" onmouseover="showTip(event, 'fs15', 31)" class="i">Authors</span><span class="o">.</span><span class="i">Parse</span>(<span onmouseout="hideTip(event, 'fs14', 32)" onmouseover="showTip(event, 'fs14', 32)" class="i">authors</span>)

<span onmouseout="hideTip(event, 'fs5', 33)" onmouseover="showTip(event, 'fs5', 33)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs16', 34)" onmouseover="showTip(event, 'fs16', 34)" class="i">topic</span><span class="o">.</span><span class="i">Topic</span>
<span class="k">for</span> <span onmouseout="hideTip(event, 'fs17', 35)" onmouseover="showTip(event, 'fs17', 35)" class="i">author</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs16', 36)" onmouseover="showTip(event, 'fs16', 36)" class="i">topic</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 37)" onmouseover="showTip(event, 'fs15', 37)" class="i">Authors</span> <span class="k">do</span>
  <span onmouseout="hideTip(event, 'fs18', 38)" onmouseover="showTip(event, 'fs18', 38)" class="f">printf</span> <span class="s">&quot; - </span><span class="pf">%s</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs17', 39)" onmouseover="showTip(event, 'fs17', 39)" class="i">author</span><span class="o">.</span><span class="i">Name</span> 
  <span onmouseout="hideTip(event, 'fs17', 40)" onmouseover="showTip(event, 'fs17', 40)" class="i">author</span><span class="o">.</span><span class="i">Born</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs19', 41)" onmouseover="showTip(event, 'fs19', 41)" class="t">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 42)" onmouseover="showTip(event, 'fs20', 42)" class="f">iter</span> (<span onmouseout="hideTip(event, 'fs18', 43)" onmouseover="showTip(event, 'fs18', 43)" class="f">printf</span> <span class="s">&quot; (</span><span class="pf">%d</span><span class="s">)&quot;</span>)
  <span onmouseout="hideTip(event, 'fs5', 44)" onmouseover="showTip(event, 'fs5', 44)" class="f">printfn</span> <span class="s">&quot;&quot;</span>
</code></pre></td>
</tr>
</table>
<p>値 <code>topic</code> には( <code>string</code> 型の) <code>Topic</code> プロパティがあります。
このプロパティは同名の属性の値を返します。
また、すべての著者名をコレクションとして返すような <code>Authors</code> メソッドもあります。
<code>Born</code> プロパティはいくつかの著者では指定されていないため、
<code>option&lt;int&gt;</code> 型として定義されています。
そのため、 <code>Option.iter</code> を使用して表示する必要があります。</p>
<p><code>died</code> 属性はサンプルからの推論時には存在しないため、
静的に型付けられた方法でこの値を取得することはできません
(ただし <code>author.XElement.Attribute(XName.Get("died"))</code> というコードを使用して
動的に取得することは可能です)。</p>
<h2>グローバル推測モード</h2>
<p>これまでの例では、同じ名前の要素を（再帰的に）含むような要素は
出てきませんでした(つまりたとえば <code>&lt;author&gt;</code> 以下に <code>&lt;author&gt;</code> ノードは
決して現れないということです)。
しかしXHTMLファイルのようなドキュメントを扱う場合、こういった状況はよくあることです。
例として以下のようなサンプルドキュメントがあるとしましょう
(単純化したバージョンが <a href="../../data/HtmlBody.xml"><code>data/HtmlBody.xml</code></a> にあります)：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="xml"><span class="k">&lt;</span><span class="i">div</span> <span class="o">id</span><span class="k">="root"</span><span class="k">&gt;</span>
  <span class="k">&lt;</span><span class="i">span</span><span class="k">&gt;</span>Main text<span class="k">&lt;/</span><span class="i">span</span><span class="k">&gt;</span>
  <span class="k">&lt;</span><span class="i">div</span> <span class="o">id</span><span class="k">="first"</span><span class="k">&gt;</span>
    <span class="k">&lt;</span><span class="i">div</span><span class="k">&gt;</span>Second text<span class="k">&lt;/</span><span class="i">div</span><span class="k">&gt;</span>
  <span class="k">&lt;/</span><span class="i">div</span><span class="k">&gt;</span>
<span class="k">&lt;/</span><span class="i">div</span><span class="k">&gt;</span>
</code></pre></td></tr></table>
<p>この例では <code>&lt;div&gt;</code> 要素内に <code>&lt;div&gt;</code> 要素がありますが、いずれも同じ型として
扱われるべきであることは明らかです。
<code>&lt;div&gt;</code> 要素を処理する再帰関数を作成できるようになっていてもらいたいはずです。
このような場合には引数 <code>Global</code> に <code>true</code> を指定します：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs21', 45)" onmouseover="showTip(event, 'fs21', 45)" class="t">Html</span> <span class="o">=</span> <span class="i">XmlProvider</span><span class="o">&lt;</span><span class="s">&quot;../../data/HtmlBody.xml&quot;</span>, <span class="i">Global</span><span class="o">=</span><span class="k">true</span><span class="o">&gt;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs22', 46)" onmouseover="showTip(event, 'fs22', 46)" class="i">html</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs21', 47)" onmouseover="showTip(event, 'fs21', 47)" class="i">Html</span><span class="o">.</span><span class="i">GetSample</span>()
</code></pre></td>
</tr>
</table>
<p>引数 <code>Global</code> を <code>true</code> にすると、型プロバイダーは同名の要素すべてを <strong>一元化</strong> します。
つまりすべての <code>&lt;div&gt;</code> 要素が同じ型として扱われることになります
( <code>&lt;div&gt;</code> に指定されたすべての属性をプロパティとして持ち、
サンプルドキュメント内で見つけられるすべての子要素の組み合わせが考慮されます)。</p>
<p>型は <code>Html</code> 以下に定義されます。
したがって、<code>Html.Div</code> を引数にとり、
各 <code>&lt;div&gt;</code> 要素を処理するような <code>printDiv</code> 関数を以下のようにして作成できます：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// &lt;div&gt; 要素のコンテンツを表示します</span>
<span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs23', 48)" onmouseover="showTip(event, 'fs23', 48)" class="f">printDiv</span> (<span onmouseout="hideTip(event, 'fs24', 49)" onmouseover="showTip(event, 'fs24', 49)" class="i">div</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs21', 50)" onmouseover="showTip(event, 'fs21', 50)" class="i">Html</span><span class="o">.</span><span class="i">Div</span>) <span class="o">=</span>
  <span onmouseout="hideTip(event, 'fs24', 51)" onmouseover="showTip(event, 'fs24', 51)" class="i">div</span><span class="o">.</span><span class="i">Spans</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 52)" onmouseover="showTip(event, 'fs12', 52)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 53)" onmouseover="showTip(event, 'fs13', 53)" class="f">iter</span> (<span onmouseout="hideTip(event, 'fs5', 54)" onmouseover="showTip(event, 'fs5', 54)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span>)
  <span onmouseout="hideTip(event, 'fs24', 55)" onmouseover="showTip(event, 'fs24', 55)" class="i">div</span><span class="o">.</span><span class="i">Divs</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 56)" onmouseover="showTip(event, 'fs12', 56)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 57)" onmouseover="showTip(event, 'fs13', 57)" class="f">iter</span> <span onmouseout="hideTip(event, 'fs23', 58)" onmouseover="showTip(event, 'fs23', 58)" class="f">printDiv</span>
  <span class="k">if</span> <span onmouseout="hideTip(event, 'fs24', 59)" onmouseover="showTip(event, 'fs24', 59)" class="i">div</span><span class="o">.</span><span class="i">Spans</span><span class="o">.</span><span class="i">Length</span> <span class="o">=</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs24', 60)" onmouseover="showTip(event, 'fs24', 60)" class="i">div</span><span class="o">.</span><span class="i">Divs</span><span class="o">.</span><span class="i">Length</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span>
      <span onmouseout="hideTip(event, 'fs24', 61)" onmouseover="showTip(event, 'fs24', 61)" class="i">div</span><span class="o">.</span><span class="i">Value</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs19', 62)" onmouseover="showTip(event, 'fs19', 62)" class="t">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 63)" onmouseover="showTip(event, 'fs20', 63)" class="f">iter</span> (<span onmouseout="hideTip(event, 'fs5', 64)" onmouseover="showTip(event, 'fs5', 64)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span>)

<span class="c">// すべての子要素と共にルートの &lt;div&gt; 要素を表示します</span>
<span onmouseout="hideTip(event, 'fs23', 65)" onmouseover="showTip(event, 'fs23', 65)" class="f">printDiv</span> <span onmouseout="hideTip(event, 'fs22', 66)" onmouseover="showTip(event, 'fs22', 66)" class="i">html</span>
</code></pre></td>
</tr>
</table>
<p>この関数はまず <code>&lt;span&gt;</code> 内のすべてのテキストを表示します
(今回の例の場合、属性が全く指定されていないため、
<code>string</code> 型として推論されます)。
次に、すべての <code>&lt;div&gt;</code> 要素を再帰的に表示します。
ネストされた要素が見つからない場合は <code>Value</code> (インナーテキスト)を表示します。</p>
<h2>RSSフィードの読み取り</h2>
<p>今回の総まとめとして、もう少し実用的な例としてRSSフィードを解析してみましょう。
既に説明した通り、型プロバイダーには相対パスあるいはWebページのアドレスを指定できます：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs25', 67)" onmouseover="showTip(event, 'fs25', 67)" class="t">Rss</span> <span class="o">=</span> <span class="i">XmlProvider</span><span class="o">&lt;</span><span class="s">&quot;http://tomasp.net/blog/rss.aspx&quot;</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>
<p>このコードではRSSフィード（および <code>http://tomasp.net</code> で使用されている機能）
を表す <code>Rss</code> 型を生成しています。
<code>Rss</code> 型にはこの型のインスタンスを生成するための機能として、staticメソッド
<code>Parse</code> 、 <code>Load</code> 、 <code>AsyncLoad</code> が定義されています。
今回の場合、スキーマとして指定したものと同じURIを再利用したいので、
staticメソッド <code>GetSample</code> を使用します：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs26', 68)" onmouseover="showTip(event, 'fs26', 68)" class="i">blog</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs25', 69)" onmouseover="showTip(event, 'fs25', 69)" class="i">Rss</span><span class="o">.</span><span class="i">GetSample</span>()
</code></pre></td>
</tr>
</table>
<p>ここまで来ればRSSフィードのタイトルと直近の投稿一覧を表示することは簡単です。
単に <code>blog</code> に続けて <code>.</code> と入力すれば、自動補完の候補一覧が確認できるでしょう。
コードとしては以下のようにします：</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Title は文字列を返すプロパティです</span>
<span onmouseout="hideTip(event, 'fs5', 70)" onmouseover="showTip(event, 'fs5', 70)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs26', 71)" onmouseover="showTip(event, 'fs26', 71)" class="i">blog</span><span class="o">.</span><span class="i">Channel</span><span class="o">.</span><span class="i">Title</span>

<span class="c">// すべてのitemノードを取得して、それぞれのタイトルとリンクを表示します</span>
<span class="k">for</span> <span onmouseout="hideTip(event, 'fs27', 72)" onmouseover="showTip(event, 'fs27', 72)" class="i">item</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs26', 73)" onmouseover="showTip(event, 'fs26', 73)" class="i">blog</span><span class="o">.</span><span class="i">Channel</span><span class="o">.</span><span class="i">Items</span> <span class="k">do</span>
  <span onmouseout="hideTip(event, 'fs5', 74)" onmouseover="showTip(event, 'fs5', 74)" class="f">printfn</span> <span class="s">&quot; - </span><span class="pf">%s</span><span class="s"> (</span><span class="pf">%s</span><span class="s">)&quot;</span> <span onmouseout="hideTip(event, 'fs27', 75)" onmouseover="showTip(event, 'fs27', 75)" class="i">item</span><span class="o">.</span><span class="i">Title</span> <span onmouseout="hideTip(event, 'fs27', 76)" onmouseover="showTip(event, 'fs27', 76)" class="i">item</span><span class="o">.</span><span class="i">Link</span>
</code></pre></td>
</tr>
</table>
<h2>関連する記事</h2>
<ul>
<li><a href="../..reference/fsharp-data-xmlprovider.html">API リファレンス: XmlProvider 型プロバイダー</a></li>
<li><a href="../../reference/fsharp-data-xelementextensions.html">API リファレンス: XElementExtensions モジュール</a></li>
</ul>

<div class="tip" id="fs1">Multiple items<br />namespace FSharp<br /><br />--------------------<br />namespace Microsoft.FSharp</div>
<div class="tip" id="fs2">Multiple items<br />namespace FSharp.Data<br /><br />--------------------<br />namespace Microsoft.FSharp.Data</div>
<div class="tip" id="fs3">type Author = obj<br /><br />Full name: XmlProvider.Author</div>
<div class="tip" id="fs4">val sample : obj<br /><br />Full name: XmlProvider.sample</div>
<div class="tip" id="fs5">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs6">type AuthorAlt = obj<br /><br />Full name: XmlProvider.AuthorAlt</div>
<div class="tip" id="fs7">val doc : string<br /><br />Full name: XmlProvider.doc</div>
<div class="tip" id="fs8">val sampleAlt : obj<br /><br />Full name: XmlProvider.sampleAlt</div>
<div class="tip" id="fs9">type Detailed = obj<br /><br />Full name: XmlProvider.Detailed</div>
<div class="tip" id="fs10">val info : obj<br /><br />Full name: XmlProvider.info</div>
<div class="tip" id="fs11">type Test = obj<br /><br />Full name: XmlProvider.Test</div>
<div class="tip" id="fs12">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs13">val iter : action:(&#39;T -&gt; unit) -&gt; source:seq&lt;&#39;T&gt; -&gt; unit<br /><br />Full name: Microsoft.FSharp.Collections.Seq.iter</div>
<div class="tip" id="fs14">val authors : string<br /><br />Full name: XmlProvider.authors</div>
<div class="tip" id="fs15">type Authors = obj<br /><br />Full name: XmlProvider.Authors</div>
<div class="tip" id="fs16">val topic : obj<br /><br />Full name: XmlProvider.topic</div>
<div class="tip" id="fs17">val author : obj</div>
<div class="tip" id="fs18">val printf : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printf</div>
<div class="tip" id="fs19">module Option<br /><br />from Microsoft.FSharp.Core</div>
<div class="tip" id="fs20">val iter : action:(&#39;T -&gt; unit) -&gt; option:&#39;T option -&gt; unit<br /><br />Full name: Microsoft.FSharp.Core.Option.iter</div>
<div class="tip" id="fs21">type Html = obj<br /><br />Full name: XmlProvider.Html</div>
<div class="tip" id="fs22">val html : obj<br /><br />Full name: XmlProvider.html</div>
<div class="tip" id="fs23">val printDiv : div:&#39;a -&gt; unit<br /><br />Full name: XmlProvider.printDiv<br /><em><br /><br />&#160;&lt;div&gt; 要素のコンテンツを表示します</em></div>
<div class="tip" id="fs24">val div : &#39;a</div>
<div class="tip" id="fs25">type Rss = obj<br /><br />Full name: XmlProvider.Rss</div>
<div class="tip" id="fs26">val blog : obj<br /><br />Full name: XmlProvider.blog</div>
<div class="tip" id="fs27">val item : obj</div>

        </div>
        <div class="span3">
          <a href="/FSharp.Data/ja/index.html">
            <img src="/FSharp.Data/images/logo.png" style="width:140px;height:140px;margin:10px 0px 0px 35px;border-style:none;" />
          </a>

          <ul class="nav nav-list" id="menu">
            <li class="nav-header">
              <a href="/FSharp.Data/ja/index.html" class="nflag"><img src="/FSharp.Data/images/ja.png" /></a>
              <a href="/FSharp.Data/index.html" class="nflag nflag2"><img src="/FSharp.Data/images/en.png" /></a>
              F# Data
            </li>
            <li class="divider"></li>
            <li><a href="https://nuget.org/packages/FSharp.Data">NuGet経由でライブラリを取得</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data">GitHub上のソースコード</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/LICENSE.md">License (Apache 2.0)</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/RELEASE_NOTES.md">リリースノート</a></li>
            <li><span>
                <a href="/FSharp.Data/ja/contributing.html">F# Dataに貢献する</a>
                (<a href="http://github.com/fsharp/FSharp.Data/blob/master/CONTRIBUTING.md">En</a>)
                </span></li>
            
            <li class="nav-header">F# Data ライブラリ</li>
            <li><span>
                <a href="/FSharp.Data/ja/index.html">はじめに</a>
                (<a href="/FSharp.Data/index.html">En</a>)
                </span></li>
            <li class="divider"></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/JsonProvider.html">JSON 型プロバイダー</a>
                (<a href="/FSharp.Data/library/JsonProvider.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/XmlProvider.html">XML 型プロバイダー</a>
                (<a href="/FSharp.Data/library/XmlProvider.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/CsvProvider.html">CSV 型プロバイダー</a>
                (<a href="/FSharp.Data/library/CsvProvider.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/WorldBank.html">WorldBank プロバイダー</a>
                (<a href="/FSharp.Data/library/WorldBank.html">En</a>)
                </span></li>
            <li class="divider"></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/Http.html">HTTP ユーティリティ</a>
                (<a href="/FSharp.Data/library/Http.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/CsvFile.html">CSV パーサーおよびリーダー</a>
                (<a href="/FSharp.Data/library/CsvFile.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/JsonValue.html">JSON パーサーおよびリーダー</a>
                (<a href="/FSharp.Data/library/JsonValue.html">En</a>)
                </span></li>

            <li class="nav-header">チュートリアル</li>
            <li><span>
                <a href="/FSharp.Data/ja/tutorials/JsonToXml.html">JSONとXMLの相互変換</a>
                (<a href="/FSharp.Data/tutorials/JsonToXml.html">En</a>)
                </span></li>

            <li><span>
                <a href="/FSharp.Data/ja/tutorials/JsonAnonymizer.html">JSONの匿名化</a>
                (<a href="/FSharp.Data/tutorials/JsonAnonymizer.html">En</a>)
                </span></li>

            <li class="nav-header">リファレンス</li>
            <li><span>
                <a href="/FSharp.Data/reference/index.html">API リファレンス (En)</a>
                </span></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/fsharp/FSharp.Data"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
  </html>