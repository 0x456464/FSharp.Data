<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>F# Data: JSONの匿名化
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The F# Data library implements type providers for working with structured file formats (CSV, HTML, JSON and XML) and for accessing the WorldBank data. It also includes helpers for parsing CSV, HTML and JSON files, and for sending HTTP requests.">
    <meta name="author" content="Tomas Petricek; Gustavo Guerra">

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/style.css" />
    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/fsdata.css" />
    <script type="text/javascript" src="/FSharp.Data/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="https://bluemountaincapital.github.io/Deedle"><img height="16" width="16" src="/images/Deedle.png" /> Deedle</a></li>
          <li><a href="https://bluemountaincapital.github.io/FSharpRProvider"><img height=" 16" width="16" src="/images/FSharpRProvider.png" /> R Provider</a></li>
          <li><a href="https://fsharp.github.io/FSharp.Charting/"><img height="16" width="16" src="/images/FSharp.Charting.png" /> F# Charting</a></li>
          <li><a href="https://fsprojects.github.io/FSharp.Data.Toolbox"><img height="16" width="16" src="/images/FSharp.Data.Toolbox.png" /> F# Data Toolbox</a></li>
        </ul>
        <h3 class="muted"><a href="/FSharp.Data/ja/index.html">F# Data</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1>F# Data: JSONの匿名化</h1>
<p>このチュートリアルではJSONドキュメント
( <a href="../library/JsonValue.html">JSONパーサーの記事</a> で説明した
<code>JsonValue</code> 型で表現されるドキュメント)
の匿名化機能を実装する方法を紹介します。
この機能はF# Dataライブラリに備わっている機能ではありませんが、
JSONドキュメントを再帰的に処理するだけで非常に簡単に実装できます。</p>
<p>JSON匿名化機能をコード内で利用したい場合には、
<a href="https://github.com/fsharp/FSharp.Data/blob/master/docs/content/tutorials/JsonAnonymizer.fsx">GitHubにあるソースコード</a> をコピーして
プロジェクトに加えるだけです。
この機能を頻繁に利用するようになり、F# Dataライブラリに取り込んでもらいたい
ということであれば <a href="https://github.com/fsharp/FSharp.Data/issues">機能のリクエスト</a> を送信してください。</p>
<p><strong>警告</strong>: この機能は単なるサンプルであるため、重要なデータを処理させないでください。</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
<span class="l">53: </span>
<span class="l">54: </span>
<span class="l">55: </span>
<span class="l">56: </span>
<span class="l">57: </span>
<span class="l">58: </span>
<span class="l">59: </span>
<span class="l">60: </span>
<span class="l">61: </span>
<span class="l">62: </span>
<span class="l">63: </span>
<span class="l">64: </span>
<span class="l">65: </span>
<span class="l">66: </span>
<span class="l">67: </span>
<span class="l">68: </span>
<span class="l">69: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;../../../../bin/FSharp.Data.dll&quot;</span>
<span class="k">open</span> <span class="i">System</span>
<span class="k">open</span> <span class="i">System</span><span class="o">.</span><span class="i">Globalization</span>
<span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Data</span>

<span class="k">type</span> <span class="i">JsonAnonymizer</span>(<span class="o">?</span><span class="i">propertiesToSkip</span>, <span class="o">?</span><span class="i">valuesToSkip</span>) <span class="o">=</span> 

    <span class="k">let</span> <span class="i">propertiesToSkip</span> <span class="o">=</span> <span class="i">Set</span><span class="o">.</span><span class="i">ofList</span> (<span class="i">defaultArg</span> <span class="i">propertiesToSkip</span> [])
    <span class="k">let</span> <span class="i">valuesToSkip</span> <span class="o">=</span> <span class="i">Set</span><span class="o">.</span><span class="i">ofList</span> (<span class="i">defaultArg</span> <span class="i">valuesToSkip</span> [])

    <span class="k">let</span> <span class="i">rng</span> <span class="o">=</span> <span class="i">Random</span>()

    <span class="k">let</span> <span class="i">digits</span> <span class="o">=</span> [| <span class="s">&#39;0&#39;</span> <span class="o">..</span> <span class="s">&#39;9&#39;</span> |]
    <span class="k">let</span> <span class="i">lowerLetters</span> <span class="o">=</span> [| <span class="s">&#39;a&#39;</span> <span class="o">..</span> <span class="s">&#39;z&#39;</span> |]
    <span class="k">let</span> <span class="i">upperLetters</span> <span class="o">=</span> [| <span class="s">&#39;A&#39;</span> <span class="o">..</span> <span class="s">&#39;Z&#39;</span> |]

    <span class="k">let</span> <span class="i">getRandomChar</span> (<span class="i">c</span><span class="o">:</span><span class="i">char</span>) <span class="o">=</span>
        <span class="k">if</span> <span class="i">Char</span><span class="o">.</span><span class="i">IsDigit</span> <span class="i">c</span> <span class="k">then</span> <span class="i">digits</span><span class="o">.</span>[<span class="i">rng</span><span class="o">.</span><span class="i">Next</span>(<span class="n">10</span>)]
        <span class="k">elif</span> <span class="i">Char</span><span class="o">.</span><span class="i">IsLetter</span> <span class="i">c</span> <span class="k">then</span>
            <span class="k">if</span> <span class="i">Char</span><span class="o">.</span><span class="i">IsLower</span> <span class="i">c</span>
            <span class="k">then</span> <span class="i">lowerLetters</span><span class="o">.</span>[<span class="i">rng</span><span class="o">.</span><span class="i">Next</span>(<span class="n">26</span>)]
            <span class="k">else</span> <span class="i">upperLetters</span><span class="o">.</span>[<span class="i">rng</span><span class="o">.</span><span class="i">Next</span>(<span class="n">26</span>)]
        <span class="k">else</span> <span class="i">c</span>

    <span class="k">let</span> <span class="i">randomize</span> (<span class="i">str</span><span class="o">:</span><span class="i">string</span>) <span class="o">=</span>
        <span class="i">String</span>(<span class="i">str</span><span class="o">.</span><span class="i">ToCharArray</span>() <span class="o">|&gt;</span> <span class="i">Array</span><span class="o">.</span><span class="i">map</span> <span class="i">getRandomChar</span>)

    <span class="k">let</span> <span class="k">rec</span> <span class="i">anonymize</span> <span class="i">json</span> <span class="o">=</span>
        <span class="k">match</span> <span class="i">json</span> <span class="k">with</span>
        | <span class="i">JsonValue</span><span class="o">.</span><span class="i">String</span> <span class="i">s</span> <span class="k">when</span> <span class="i">valuesToSkip</span><span class="o">.</span><span class="i">Contains</span> <span class="i">s</span> <span class="k">-&gt;</span> <span class="i">json</span>
        | <span class="i">JsonValue</span><span class="o">.</span><span class="i">String</span> <span class="i">s</span> <span class="k">-&gt;</span>
            <span class="k">let</span> <span class="i">typ</span> <span class="o">=</span> <span class="i">Runtime</span><span class="o">.</span><span class="i">StructuralInference</span><span class="o">.</span><span class="i">inferPrimitiveType</span> <span class="i">CultureInfo</span><span class="o">.</span><span class="i">InvariantCulture</span> <span class="i">s</span>
            <span class="k">if</span> <span class="i">typ</span> <span class="o">=</span> <span class="i">typeof</span><span class="o">&lt;</span><span class="i">Guid</span><span class="o">&gt;</span> <span class="k">then</span> <span class="i">Guid</span><span class="o">.</span><span class="i">NewGuid</span>()<span class="o">.</span><span class="i">ToString</span>()
            <span class="k">elif</span> <span class="i">typ</span> <span class="o">=</span> <span class="i">typeof</span><span class="o">&lt;</span><span class="i">Runtime</span><span class="o">.</span><span class="i">StructuralTypes</span><span class="o">.</span><span class="i">Bit0</span><span class="o">&gt;</span> <span class="o">||</span> <span class="i">typ</span> <span class="o">=</span> <span class="i">typeof</span><span class="o">&lt;</span><span class="i">Runtime</span><span class="o">.</span><span class="i">StructuralTypes</span><span class="o">.</span><span class="i">Bit1</span><span class="o">&gt;</span> <span class="k">then</span> <span class="i">s</span>
            <span class="k">elif</span> <span class="i">typ</span> <span class="o">=</span> <span class="i">typeof</span><span class="o">&lt;</span><span class="i">DateTime</span><span class="o">&gt;</span> <span class="k">then</span> <span class="i">s</span>
            <span class="k">else</span> 
                <span class="k">let</span> <span class="i">prefix</span>, <span class="i">s</span> <span class="o">=</span>
                    <span class="k">if</span> <span class="i">s</span><span class="o">.</span><span class="i">StartsWith</span> <span class="s">&quot;http://&quot;</span> <span class="k">then</span> <span class="s">&quot;http://&quot;</span>, <span class="i">s</span><span class="o">.</span><span class="i">Substring</span>(<span class="s">&quot;http://&quot;</span><span class="o">.</span><span class="i">Length</span>)
                    <span class="k">elif</span> <span class="i">s</span><span class="o">.</span><span class="i">StartsWith</span> <span class="s">&quot;https://&quot;</span> <span class="k">then</span> <span class="s">&quot;https://&quot;</span>, <span class="i">s</span><span class="o">.</span><span class="i">Substring</span>(<span class="s">&quot;https://&quot;</span><span class="o">.</span><span class="i">Length</span>)
                    <span class="k">else</span> <span class="s">&quot;&quot;</span>, <span class="i">s</span>
                <span class="i">prefix</span> <span class="o">+</span> <span class="i">randomize</span> <span class="i">s</span>
            <span class="o">|&gt;</span> <span class="i">JsonValue</span><span class="o">.</span><span class="i">String</span>
        | <span class="i">JsonValue</span><span class="o">.</span><span class="i">Number</span> <span class="i">d</span> <span class="k">-&gt;</span> 
            <span class="k">let</span> <span class="i">typ</span> <span class="o">=</span> <span class="i">Runtime</span><span class="o">.</span><span class="i">StructuralInference</span><span class="o">.</span><span class="i">inferPrimitiveType</span> <span class="i">CultureInfo</span><span class="o">.</span><span class="i">InvariantCulture</span> (<span class="i">d</span><span class="o">.</span><span class="i">ToString</span>())
            <span class="k">if</span> <span class="i">typ</span> <span class="o">=</span> <span class="i">typeof</span><span class="o">&lt;</span><span class="i">Runtime</span><span class="o">.</span><span class="i">StructuralTypes</span><span class="o">.</span><span class="i">Bit0</span><span class="o">&gt;</span> <span class="o">||</span> <span class="i">typ</span> <span class="o">=</span> <span class="i">typeof</span><span class="o">&lt;</span><span class="i">Runtime</span><span class="o">.</span><span class="i">StructuralTypes</span><span class="o">.</span><span class="i">Bit1</span><span class="o">&gt;</span>
            <span class="k">then</span> <span class="i">json</span>
            <span class="k">else</span> <span class="i">d</span><span class="o">.</span><span class="i">ToString</span>() <span class="o">|&gt;</span> <span class="i">randomize</span> <span class="o">|&gt;</span> <span class="i">Decimal</span><span class="o">.</span><span class="i">Parse</span> <span class="o">|&gt;</span> <span class="i">JsonValue</span><span class="o">.</span><span class="i">Number</span>
        | <span class="i">JsonValue</span><span class="o">.</span><span class="i">Float</span> <span class="i">f</span> <span class="k">-&gt;</span> 
            <span class="i">f</span><span class="o">.</span><span class="i">ToString</span>()
            <span class="o">|&gt;</span> <span class="i">randomize</span> 
            <span class="o">|&gt;</span> <span class="i">Double</span><span class="o">.</span><span class="i">Parse</span> 
            <span class="o">|&gt;</span> <span class="i">JsonValue</span><span class="o">.</span><span class="i">Float</span>
        | <span class="i">JsonValue</span><span class="o">.</span><span class="i">Boolean</span> _  | <span class="i">JsonValue</span><span class="o">.</span><span class="i">Null</span> <span class="k">-&gt;</span> <span class="i">json</span>
        | <span class="i">JsonValue</span><span class="o">.</span><span class="i">Record</span> <span class="i">props</span> <span class="k">-&gt;</span> 
            <span class="i">props</span> 
            <span class="o">|&gt;</span> <span class="i">Array</span><span class="o">.</span><span class="i">map</span> (<span class="k">fun</span> (<span class="i">key</span>, <span class="i">value</span>) <span class="k">-&gt;</span> <span class="i">key</span>, <span class="k">if</span> <span class="i">propertiesToSkip</span><span class="o">.</span><span class="i">Contains</span> <span class="i">key</span> <span class="k">then</span> <span class="i">value</span> <span class="k">else</span> <span class="i">anonymize</span> <span class="i">value</span>)
            <span class="o">|&gt;</span> <span class="i">JsonValue</span><span class="o">.</span><span class="i">Record</span>
        | <span class="i">JsonValue</span><span class="o">.</span><span class="i">Array</span> <span class="i">array</span> <span class="k">-&gt;</span> 
            <span class="i">array</span> 
            <span class="o">|&gt;</span> <span class="i">Array</span><span class="o">.</span><span class="i">map</span> <span class="i">anonymize</span> 
            <span class="o">|&gt;</span> <span class="i">JsonValue</span><span class="o">.</span><span class="i">Array</span>

    <span class="k">member</span> <span class="i">__</span><span class="o">.</span><span class="i">Anonymize</span> <span class="i">json</span> <span class="o">=</span> <span class="i">anonymize</span> <span class="i">json</span>

<span class="k">let</span> <span class="i">json</span> <span class="o">=</span> <span class="i">JsonValue</span><span class="o">.</span><span class="i">Load</span> (<span class="k">__SOURCE_DIRECTORY__</span> <span class="o">+</span> <span class="s">&quot;../../data/TwitterStream.json&quot;</span>)
<span class="i">printfn</span> <span class="s">&quot;%O&quot;</span> <span class="i">json</span>

<span class="k">let</span> <span class="i">anonymizedJson</span> <span class="o">=</span> (<span class="i">JsonAnonymizer</span> [<span class="s">&quot;lang&quot;</span>])<span class="o">.</span><span class="i">Anonymize</span> <span class="i">json</span>
<span class="i">printfn</span> <span class="s">&quot;%O&quot;</span> <span class="i">anonymizedJson</span>
</code></pre></td>
</tr>
</table>
<h2>関連する記事</h2>
<ul>
<li>
<a href="../library/JsonValue.html">F# Data: JSON パーサーおよびリーダー</a> -
JSONの値を動的に処理する方法についての説明があります。
</li>
<li>
<a href="../library/JsonProvider.html">F# Data: JSON 型プロバイダー</a> -
型安全な方法でJSONデータにアクセスする機能を持った
F# 型プロバイダーについて説明しています。
</li>
</ul>


        </div>
        <div class="span3">
          <a href="/FSharp.Data/ja/index.html">
            <img src="/FSharp.Data/images/logo.png" style="width:140px;height:140px;margin:10px 0px 0px 35px;border-style:none;" />
          </a>

          <ul class="nav nav-list" id="menu">
            <li class="nav-header">
              <a href="/FSharp.Data/ja/index.html" class="nflag"><img src="/FSharp.Data/images/ja.png" /></a>
              <a href="/FSharp.Data/index.html" class="nflag nflag2"><img src="/FSharp.Data/images/en.png" /></a>
              F# Data
            </li>
            <li class="divider"></li>
            <li><a href="https://nuget.org/packages/FSharp.Data">NuGet経由でライブラリを取得</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data">GitHub上のソースコード</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/LICENSE.md">License (Apache 2.0)</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/RELEASE_NOTES.md">リリースノート</a></li>
            <li><span>
                <a href="/FSharp.Data/ja/contributing.html">F# Dataに貢献する</a>
                (<a href="http://github.com/fsharp/FSharp.Data/blob/master/CONTRIBUTING.md">En</a>)
                </span></li>
            
            <li class="nav-header">F# Data ライブラリ</li>
            <li><span>
                <a href="/FSharp.Data/ja/index.html">はじめに</a>
                (<a href="/FSharp.Data/index.html">En</a>)
                </span></li>
            <li class="divider"></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/JsonProvider.html">JSON 型プロバイダー</a>
                (<a href="/FSharp.Data/library/JsonProvider.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/XmlProvider.html">XML 型プロバイダー</a>
                (<a href="/FSharp.Data/library/XmlProvider.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/CsvProvider.html">CSV 型プロバイダー</a>
                (<a href="/FSharp.Data/library/CsvProvider.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/WorldBank.html">WorldBank プロバイダー</a>
                (<a href="/FSharp.Data/library/WorldBank.html">En</a>)
                </span></li>
            <li class="divider"></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/Http.html">HTTP ユーティリティ</a>
                (<a href="/FSharp.Data/library/Http.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/CsvFile.html">CSV パーサーおよびリーダー</a>
                (<a href="/FSharp.Data/library/CsvFile.html">En</a>)
                </span></li>
            <li><span>
                <a href="/FSharp.Data/ja/library/JsonValue.html">JSON パーサーおよびリーダー</a>
                (<a href="/FSharp.Data/library/JsonValue.html">En</a>)
                </span></li>

            <li class="nav-header">チュートリアル</li>
            <li><span>
                <a href="/FSharp.Data/ja/tutorials/JsonToXml.html">JSONとXMLの相互変換</a>
                (<a href="/FSharp.Data/tutorials/JsonToXml.html">En</a>)
                </span></li>

            <li><span>
                <a href="/FSharp.Data/ja/tutorials/JsonAnonymizer.html">JSONの匿名化</a>
                (<a href="/FSharp.Data/tutorials/JsonAnonymizer.html">En</a>)
                </span></li>

            <li class="nav-header">リファレンス</li>
            <li><span>
                <a href="/FSharp.Data/reference/index.html">API リファレンス (En)</a>
                </span></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/fsharp/FSharp.Data"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
  </html>